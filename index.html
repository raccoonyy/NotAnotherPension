<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>yourfuture - êµ­ë¯¼ì—°ê¸ˆ vs ê°œì¸ì—°ê¸ˆ ë¹„êµ</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen">
  <div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold text-center text-gray-800 mb-8">
      yourfuture
    </h1>
    <p class="text-center text-gray-600 mb-8">
      êµ­ë¯¼ì—°ê¸ˆ vs ê°œì¸ì—°ê¸ˆ, ë˜‘ê°™ì€ ëˆìœ¼ë¡œ ë­ê°€ ë” ìœ ë¦¬í• ê¹Œ?
    </p>

    <!-- ë°ì´í„° ë¡œë”© ìƒíƒœ í‘œì‹œ -->
    <div id="loading-status" class="text-center mb-4">
      <span class="text-gray-500">ë°ì´í„° ë¡œë”© ì¤‘...</span>
    </div>

    <!-- @CODE:UI-001 | SPEC: SPEC-UI-001/spec.md -->
    <!-- ì…ë ¥í¼ + ë°ì´í„° ì¶œì²˜ ì»¨í…Œì´ë„ˆ -->
    <div class="max-w-4xl mx-auto flex flex-col lg:flex-row gap-6">
      <!-- ê³„ì‚°ê¸° í¼ (ë°ì´í„° ë¡œë“œ í›„ í™œì„±í™”) -->
      <div id="calculator-form" class="hidden flex-1 lg:max-w-md">
        <div class="bg-white rounded-lg shadow-md p-6">
        <!-- ì§ì—… êµ¬ë¶„ -->
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-2">ì§ì—… êµ¬ë¶„</label>
          <div class="flex gap-4">
            <label class="flex items-center cursor-pointer">
              <input type="radio" name="jobType" value="laborer" checked
                     class="w-4 h-4 text-blue-600" onchange="toggleJobType()">
              <span class="ml-2 text-gray-700">ê·¼ë¡œì</span>
            </label>
            <label class="flex items-center cursor-pointer">
              <input type="radio" name="jobType" value="business"
                     class="w-4 h-4 text-blue-600" onchange="toggleJobType()">
              <span class="ml-2 text-gray-700">ì‚¬ì—…ì</span>
            </label>
          </div>
        </div>

        <!-- í˜„ì¬ ë‚˜ì´ -->
        <div class="mb-4">
          <label for="currentAge" class="block text-sm font-medium text-gray-700 mb-2">
            í˜„ì¬ ë‚˜ì´
          </label>
          <div class="flex items-center">
            <input type="number" id="currentAge" value="30" min="20" max="59"
                   class="w-24 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            <span class="ml-2 text-gray-600">ì„¸</span>
          </div>
        </div>

        <!-- ê·¼ë¡œì: ì—°ë´‰ ì…ë ¥ -->
        <div id="laborer-income" class="mb-4">
          <label for="annualSalary" class="block text-sm font-medium text-gray-700 mb-2">
            í˜„ì¬ ì—°ë´‰ (ì„¸ì „)
          </label>
          <div class="flex items-center">
            <input type="number" id="annualSalary" value="5000" min="1"
                   class="w-32 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            <span class="ml-2 text-gray-600">ë§Œì›</span>
          </div>
        </div>

        <!-- ì‚¬ì—…ì: ì›”í‰ê·  ì‚¬ì—…ì†Œë“ ì…ë ¥ -->
        <div id="business-income" class="mb-4 hidden">
          <label for="monthlyBusinessIncome" class="block text-sm font-medium text-gray-700 mb-2">
            ì›”í‰ê·  ì‚¬ì—…ì†Œë“
          </label>
          <div class="flex items-center">
            <input type="number" id="monthlyBusinessIncome" value="500" min="1"
                   class="w-32 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            <span class="ml-2 text-gray-600">ë§Œì›</span>
          </div>
        </div>

        <!-- ì˜¤ë¥˜ ë©”ì‹œì§€ -->
        <div id="error-message" class="mb-4 hidden">
          <p class="text-red-600 text-sm"></p>
        </div>

        <!-- ê³„ì‚°í•˜ê¸° ë²„íŠ¼ -->
        <button id="calculate-btn" onclick="handleCalculate()"
                class="w-full bg-blue-600 text-white py-3 px-4 rounded-md hover:bg-blue-700 transition-colors font-medium flex items-center justify-center gap-2">
          <span id="btn-text">ê³„ì‚°í•˜ê¸°</span>
          <svg id="btn-spinner" class="hidden animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
        </button>
        </div>
      </div>

      <!-- ë°ì´í„° ì¶œì²˜ (ìš°ì¸¡) -->
      <div class="flex-1 lg:max-w-sm">
        <div class="bg-white rounded-lg shadow-md p-4 h-full">
          <h3 class="text-lg font-semibold text-gray-800 flex items-center gap-2 mb-4">
            <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            ë°ì´í„° ì¶œì²˜
          </h3>
          <div class="space-y-3 text-sm text-gray-600">
            <div class="flex items-start gap-2">
              <span class="text-blue-500 mt-0.5">â€¢</span>
              <div>
                <span class="font-medium text-gray-700">ì†Œë¹„ìë¬¼ê°€ ìƒìŠ¹ë¥ : ê³¼ê±° 20ë…„ í‰ê· ì¸ 2.5% ì ìš©</span>
                <p class="text-xs text-gray-500 mt-0.5"><a href="https://snapshot.bok.or.kr/dashboard/C6" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline">í•œêµ­ì€í–‰</a></p>
              </div>
            </div>
            <div class="flex items-start gap-2">
              <span class="text-blue-500 mt-0.5">â€¢</span>
              <div>
                <span class="font-medium text-gray-700">ê°œì¸ì—°ê¸ˆ ìˆ˜ìµë¥ : ê³¼ê±° ì‹¤ì  + ë¯¸ë˜ ì˜ˆìƒ(7.72%)</span>
                <p class="text-xs text-gray-500 mt-0.5">ì²˜ìŒ 3~10ë…„: ê° í€ë“œì˜ ì‹¤ì œ ìˆ˜ìµë¥  (3/5/7/10ë…„ ë°ì´í„°)</p>
                <p class="text-xs text-gray-500 mt-0.5">ì´í›„ ê¸°ê°„: ìƒìœ„ 500ê°œ í€ë“œ í‰ê·  7.72% ì ìš©</p>
                <p class="text-xs text-gray-500 mt-0.5"><a href="https://www.fss.or.kr/fss/lifeplan/goodsCmpr/list.do?menuNo=200961" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline">ê¸ˆìœµê°ë…ì› ì—°ê¸ˆì €ì¶• ë¹„êµê³µì‹œ</a></p>
              </div>
            </div>
            <div class="flex items-start gap-2">
              <span class="text-blue-500 mt-0.5">â€¢</span>
              <div>
                <span class="font-medium text-gray-700">í‰ê·  ì·¨ì—… ì—°ë ¹: 30ì„¸</span>
                <p class="text-xs text-gray-500 mt-0.5"><a href="https://news.incruit.com/news/newsview.asp?newsno=437372" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline">ì¸í¬ë£¨íŠ¸ 2025 ì„¤ë¬¸</a><p></p>
              </div>
            </div>
            <div class="flex items-start gap-2">
              <span class="text-blue-500 mt-0.5">â€¢</span>
              <div>
                <span class="font-medium text-gray-700">ì‹ ì…ì‚¬ì› ì´ˆì„ í‰ê· (2023ë…„ ì¡°ì‚¬): 3,800ë§Œì›</span>
                <p class="text-xs text-gray-500 mt-0.5"><a href="https://kosis.kr/statHtml/statHtml.do?tblId=DT_14217M_241&orgId=115" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline">KOSIS 2023</a></p>
              </div>
            </div>
            <div class="flex items-start gap-2">
              <span class="text-blue-500 mt-0.5">â€¢</span>
              <div>
                <span class="font-medium text-gray-700">ê¸°ëŒ€ìˆ˜ëª…: 65ì„¸ ë„ë‹¬ ì—°ë„ì˜ ê¸°ëŒ€ìˆ˜ëª…ìœ¼ë¡œ ìë™ ê³„ì‚° </span>
                <p class="text-xs text-gray-500 mt-0.5"><a href="https://kosis.kr/statHtml/statHtml.do?orgId=101&tblId=DT_1BPA003" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline">KOSIS ì¥ë˜ì¸êµ¬ì¶”ê³„</a></p>
              </div>
            </div>
            <div class="flex items-start gap-2">
              <span class="text-blue-500 mt-0.5">â€¢</span>
              <div>
                <span class="font-medium text-gray-700">êµ­ë¯¼ì—°ê¸ˆ ê°œì •ì•ˆ: ë³´í—˜ë£Œìœ¨ 9%â†’13%, ì†Œë“ëŒ€ì²´ìœ¨ 43%</span>
                <p class="text-xs text-gray-500 mt-0.5"><a href="https://www.nps.or.kr" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline">êµ­ë¯¼ì—°ê¸ˆê³µë‹¨</a></p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- @CODE:UI-002 | SPEC: SPEC-UI-002/spec.md -->
    <!-- ê²°ê³¼ í…Œì´ë¸” ì»¨í…Œì´ë„ˆ -->
    <div id="result-container" class="hidden mt-8">
      <!-- ìš”ì•½ ì¹´ë“œ -->
      <div id="summary-cards" class="mb-8">
        <h2 id="summary-title" class="text-xl font-bold text-gray-800 mb-2 text-center">ì˜ˆìƒ ì´ ìˆ˜ë ¹ì•¡ ë¹„êµ</h2>
        <p id="life-expectancy-info" class="text-sm text-gray-500 text-center mb-4"></p>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="summary-grid">
          <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
        </div>
      </div>

      <!-- ì—°ë„ë³„ ë‚©ì… ìƒì„¸ í…Œì´ë¸” -->
      <div class="bg-white rounded-lg shadow-md p-4 mb-8">
        <h3 class="text-lg font-semibold text-gray-800 mb-4">ë‚©ì… ê¸°ê°„ ìƒì„¸ ë‚´ì—­</h3>
        <div class="overflow-x-auto">
          <table id="result-table" class="min-w-full text-sm">
            <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
          </table>
        </div>
      </div>

      <!-- ìˆ˜ë ¹ ê¸°ê°„ ìˆ˜ë ¹ì•¡ í…Œì´ë¸” -->
      <div class="bg-white rounded-lg shadow-md p-4">
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 mb-2">
          <h3 class="text-lg font-semibold text-gray-800" id="receiving-table-title">65~85ì„¸ ì—°ê°„ ìˆ˜ë ¹ì•¡ ë¹„êµ</h3>
          <div class="relative">
            <input
              type="text"
              id="pension-search"
              placeholder="ì—°ê¸ˆ ìƒí’ˆ ê²€ìƒ‰..."
              class="w-full sm:w-64 px-3 py-2 pl-9 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"
            />
            <svg class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
          </div>
        </div>
        <p class="text-sm text-gray-500 mb-4">
          * êµ­ë¯¼ì—°ê¸ˆ: ë¬¼ê°€ì—°ë™ (ë§¤ë…„ <span id="inflation-rate-display">2.5%</span> ì¸ìƒ)
          | ê°œì¸ì—°ê¸ˆ: ê³ ì • ìˆ˜ë ¹ì•¡
        </p>
        <div class="overflow-x-auto">
          <table id="receiving-table" class="min-w-full text-sm">
            <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
          </table>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ============================================================
    // @CODE:DATA-001 | SPEC: SPEC-DATA-001/spec.md
    // ë°ì´í„° íŒŒì¼ êµ¬ì¡° ë° ë¡œë”© ì‹œìŠ¤í…œ
    // ============================================================

    /**
     * ì „ì—­ ë°ì´í„° ì €ì¥ì†Œ
     * @type {Object|null}
     */
    let APP_DATA = null;

    /**
     * ê¸°ë³¸ê°’ (í´ë°±ìš©)
     * data.json ë¡œë“œ ì‹¤íŒ¨ ì‹œ ë˜ëŠ” í•„ë“œ ëˆ„ë½ ì‹œ ì‚¬ìš©
     */
    const DEFAULT_DATA = {
      updated_at: "2025-01-01",
      nps: {
        a_value: 2989352,
        replacement_rate: 0.43,  // 2026ë…„ ê°œì •: 40% â†’ 43%
        max_monthly_income: 5900000,
        min_monthly_income: 370000,
        // 2026ë…„ ê°œì •: ë³´í—˜ë£Œìœ¨ ì—°ë„ë³„ ì¸ìƒ (9% â†’ 13%)
        contribution_rates: {
          2025: 0.09,
          2026: 0.095,
          2027: 0.10,
          2028: 0.105,
          2029: 0.11,
          2030: 0.115,
          2031: 0.12,
          2032: 0.125,
          2033: 0.13
        }
      },
      market: {
        sp500_10yr_avg: 0.08,
        kospi_10yr_avg: 0.05,
        inflation_rate: 0.025
      },
      wage_curve: {
        "20s": 0.05,
        "30s": 0.05,
        "40s": 0.03,
        "50s_early": 0.00,
        "50s_late": -0.02
      },
      employment: {
        average_start_age: 30,
        average_start_income: 30000000
      },
      receiving: {
        start_age: 65,
        end_age: 85,
        years: 20
      }
    };

    /** ì—°ê¸ˆì €ì¶•í€ë“œ ìƒí’ˆ (CSVì—ì„œ ë¡œë“œ) */
    let BANK_PENSION_PRODUCTS = [];

    /** ë¬¼ê°€ìƒìŠ¹ë¥  (CSVì—ì„œ ê³„ì‚°) */
    let INFLATION_RATE = 0.025;

    /** ê¸°ëŒ€ìˆ˜ëª… ë°ì´í„° (ì—°ë„ë³„) */
    let LIFE_EXPECTANCY_DATA = {};

    /** ì „ì²´ ê°œì¸ì—°ê¸ˆ ìƒí’ˆ (ê¸°ì¡´ + í€ë“œ ìƒí’ˆ) */
    let ALL_PENSION_PRODUCTS = [];

    /**
     * ë¯¸ë˜ ì˜ˆìƒ ìˆ˜ìµë¥  (ìƒìœ„ 500ê°œ í€ë“œ í‰ê· )
     * ê³¼ê±° ë°ì´í„°ê°€ ì—†ëŠ” ê¸°ê°„ì— ì ìš©
     */
    const FUTURE_RETURN_RATE = 0.0772;

    /**
     * ì—°ê¸ˆì €ì¶•í€ë“œ CSV íŒŒì¼ ë¡œë“œ ë° íŒŒì‹±
     * @returns {Promise<Array>} íŒŒì‹±ëœ ìƒí’ˆ ë°°ì—´
     */
    async function loadPensionProducts() {
      try {
        const response = await fetch('./data/100lifeplan_fund.csv');
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}`);
        }
        const text = await response.text();
        return parseCSV(text);
      } catch (error) {
        console.warn('ì—°ê¸ˆì €ì¶•í€ë“œ CSV ë¡œë“œ ì‹¤íŒ¨:', error.message);
        return [];
      }
    }

    /**
     * CSV í…ìŠ¤íŠ¸ë¥¼ íŒŒì‹±í•˜ì—¬ ìƒí’ˆ ë°°ì—´ ë°˜í™˜
     * ì‰¼í‘œê°€ í¬í•¨ëœ ìˆ«ìë¥¼ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ë”°ì˜´í‘œ ë‚´ ì‰¼í‘œë¥¼ ë¬´ì‹œ
     * @param {string} text - CSV í…ìŠ¤íŠ¸
     * @returns {Array} íŒŒì‹±ëœ ìƒí’ˆ ë°°ì—´
     */
    function parseCSV(text) {
      const lines = text.split('\n');
      const products = [];

      // CSV ë¼ì¸ì„ íŒŒì‹± (ë”°ì˜´í‘œ ë‚´ ì‰¼í‘œ ì²˜ë¦¬)
      function parseCSVLine(line) {
        const result = [];
        let current = '';
        let inQuotes = false;

        for (let i = 0; i < line.length; i++) {
          const char = line[i];
          if (char === '"') {
            inQuotes = !inQuotes;
          } else if (char === ',' && !inQuotes) {
            result.push(current.trim());
            current = '';
          } else {
            current += char;
          }
        }
        result.push(current.trim());
        return result;
      }

      // Row 9(ì¸ë±ìŠ¤ 8)ë¶€í„° ë°ì´í„° ì‹œì‘
      for (let i = 8; i < lines.length; i++) {
        const cols = parseCSVLine(lines[i]);
        if (!cols[0]?.trim()) continue;

        // ì»¬ëŸ¼ êµ¬ì¡° (100lifeplan_fund.csv - í€ë“œ):
        // 0: ìƒí’ˆëª…, 1: ê¸ˆìœµíšŒì‚¬, 2: ìƒí’ˆìœ í˜•, 3: ìµœì´ˆíŒë§¤ì¼, 4: íŒë§¤ì—¬ë¶€, 5: ì¤‘ë„í•´ì§€
        // 6: ë‚©ì…ì›ê¸ˆ(25ë…„), 7: ì ë¦½ê¸ˆ(25ë…„), 8: ìˆ˜ìµë¥ (25ë…„), 9: ìˆ˜ì •ê¸°ì¤€ê°€ìˆ˜ìµë¥ (25ë…„)
        // 10: ë‚©ì…ì›ê¸ˆ(24ë…„), 11: ì ë¦½ê¸ˆ(24ë…„), 12: ìˆ˜ìµë¥ (24ë…„), 13: ìˆ˜ì •ê¸°ì¤€ê°€ìˆ˜ìµë¥ (24ë…„)
        // 14: 3ë…„ìˆ˜ìµë¥ , 15: 5ë…„ìˆ˜ìµë¥ , 16: 7ë…„ìˆ˜ìµë¥ , 17: 10ë…„ìˆ˜ìµë¥ 
        // 18: 3ë…„ìˆ˜ìˆ˜ë£Œ, 19: 5ë…„ìˆ˜ìˆ˜ë£Œ, 20: 7ë…„ìˆ˜ìˆ˜ë£Œ, 21: 10ë…„ìˆ˜ìˆ˜ë£Œ

        const name = cols[0].trim();
        const bank = cols[1]?.trim() || '';
        const type = cols[2]?.trim() || '';

        // 10ë…„ ìˆ˜ìµë¥  ìš°ì„ , ì—†ìœ¼ë©´ 7ë…„, 5ë…„, 3ë…„ ìˆœìœ¼ë¡œ ì‚¬ìš©
        // returnYears: í•´ë‹¹ ìˆ˜ìµë¥ ì˜ ì¸¡ì • ê¸°ê°„ (ê³¼ê±° ë°ì´í„° ê¸°ê°„)
        let returnRate = 0;
        let returnYears = 0;
        
        if (parseFloat(cols[17]) > 0) {
          returnRate = parseFloat(cols[17]);
          returnYears = 10;
        } else if (parseFloat(cols[16]) > 0) {
          returnRate = parseFloat(cols[16]);
          returnYears = 7;
        } else if (parseFloat(cols[15]) > 0) {
          returnRate = parseFloat(cols[15]);
          returnYears = 5;
        } else if (parseFloat(cols[14]) > 0) {
          returnRate = parseFloat(cols[14]);
          returnYears = 3;
        }

        // 10ë…„ ìˆ˜ìˆ˜ë£Œ ìš°ì„ , ì—†ìœ¼ë©´ 7ë…„, 5ë…„, 3ë…„ ìˆœìœ¼ë¡œ ì‚¬ìš©
        let feeRate = parseFloat(cols[21]) || 0;
        if (feeRate === 0) feeRate = parseFloat(cols[20]) || 0;
        if (feeRate === 0) feeRate = parseFloat(cols[19]) || 0;
        if (feeRate === 0) feeRate = parseFloat(cols[18]) || 0;

        // ìˆ˜ìµë¥ ì´ 0ì´ê±°ë‚˜ ë¹„ì •ìƒì ìœ¼ë¡œ ë†’ì€ ê²½ìš° ì œì™¸ (ì—° ìˆ˜ìµë¥  30% ì´ˆê³¼ëŠ” ë¹„ì •ìƒ)
        if (returnRate === 0 || returnRate > 30 || returnRate < -30) continue;

        // CSV ë°ì´í„°ì˜ ì‹¤ì œ ìˆ˜ìµë¥  ì‚¬ìš© (10ë…„/7ë…„/5ë…„/3ë…„ ì¥ê¸° ìˆ˜ìµë¥ )
        // returnYears: ê³¼ê±° ë°ì´í„° ê¸°ê°„ (ì´ ê¸°ê°„ì€ ì‹¤ì œ ìˆ˜ìµë¥  ì ìš©)
        // futureReturn: ë¯¸ë˜ ì˜ˆìƒ ìˆ˜ìµë¥  (ìƒìœ„ 500ê°œ í€ë“œ í‰ê· )
        products.push({
          id: `fund_${i - 8}`,
          name: `${name}`,
          bank: bank,
          type: type,
          return: returnRate / 100,  // ê³¼ê±° ì‹¤ì œ ìˆ˜ìµë¥  (%ë¥¼ ì†Œìˆ˜ë¡œ ë³€í™˜)
          returnYears: returnYears,  // ê³¼ê±° ë°ì´í„° ê¸°ê°„ (ë…„)
          futureReturn: FUTURE_RETURN_RATE,  // ë¯¸ë˜ ì˜ˆìƒ ìˆ˜ìµë¥ 
          fee: feeRate / 100
        });
      }

      console.log(`ì—°ê¸ˆì €ì¶•í€ë“œ ${products.length}ê°œ ìƒí’ˆ ë¡œë“œ ì™„ë£Œ`);
      return products;
    }

    /**
     * ë¬¼ê°€ìƒìŠ¹ë¥  CSV ë¡œë“œ ë° í‰ê·  ê³„ì‚°
     * @returns {Promise<number>} í‰ê·  ë¬¼ê°€ìƒìŠ¹ë¥ 
     */
    async function loadInflationData() {
      try {
        const response = await fetch('./data/consumer-price-inflation.csv');
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}`);
        }
        const text = await response.text();
        return calculateAverageInflation(text);
      } catch (error) {
        console.warn('ë¬¼ê°€ìƒìŠ¹ë¥  CSV ë¡œë“œ ì‹¤íŒ¨:', error.message);
        return DEFAULT_DATA.market.inflation_rate;
      }
    }

    /**
     * ë¬¼ê°€ìƒìŠ¹ë¥  CSVì—ì„œ í‰ê·  ê³„ì‚° (ìµœê·¼ 20ë…„)
     * @param {string} csvText - CSV í…ìŠ¤íŠ¸
     * @returns {number} í‰ê·  ë¬¼ê°€ìƒìŠ¹ë¥  (ì†Œìˆ˜)
     */
    function calculateAverageInflation(csvText) {
      const lines = csvText.split('\n');
      let total = 0;
      let count = 0;

      // Row 8(ì¸ë±ìŠ¤ 7)ë¶€í„° ë°ì´í„° ì‹œì‘
      // ìµœê·¼ 20ë…„ ë°ì´í„°ë§Œ ì‚¬ìš© (ì•½ 240ê°œì›”)
      const startIndex = Math.max(7, lines.length - 240);

      for (let i = startIndex; i < lines.length; i++) {
        const cols = lines[i].split(',');
        const rate = parseFloat(cols[2]); // ì „ë…„ë™ì›”ëŒ€ë¹„ (%)
        if (!isNaN(rate)) {
          total += rate;
          count++;
        }
      }

      const avgRate = count > 0 ? (total / count) / 100 : 0.025;
      console.log(`ë¬¼ê°€ìƒìŠ¹ë¥  í‰ê· : ${(avgRate * 100).toFixed(2)}% (${count}ê°œì›” ë°ì´í„°)`);
      return avgRate;
    }

    /**
     * ê¸°ëŒ€ìˆ˜ëª… CSV íŒŒì¼ ë¡œë“œ ë° íŒŒì‹±
     * @returns {Promise<Object>} ì—°ë„ë³„ ê¸°ëŒ€ìˆ˜ëª… ë°ì´í„°
     */
    async function loadLifeExpectancyData() {
      try {
        const response = await fetch('./data/ì¥ë˜_ê¸°ëŒ€ìˆ˜ëª….csv');
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}`);
        }
        const text = await response.text();
        return parseLifeExpectancyCSV(text);
      } catch (error) {
        console.warn('ê¸°ëŒ€ìˆ˜ëª… CSV ë¡œë“œ ì‹¤íŒ¨:', error.message);
        return { 2025: 84.5 }; // ê¸°ë³¸ê°’
      }
    }

    /**
     * ê¸°ëŒ€ìˆ˜ëª… CSV íŒŒì‹±
     * @param {string} csvText - CSV í…ìŠ¤íŠ¸
     * @returns {Object} { ì—°ë„: ê¸°ëŒ€ìˆ˜ëª… }
     */
    function parseLifeExpectancyCSV(csvText) {
      const lines = csvText.split('\n');
      const data = {};

      // ì²« ë²ˆì§¸ ì¤„ì€ í—¤ë”, ë‘ ë²ˆì§¸ ì¤„ë¶€í„° ë°ì´í„°
      for (let i = 1; i < lines.length; i++) {
        const cols = lines[i].split(',');
        if (cols.length < 3) continue;

        const assumption = cols[0].replace(/"/g, '').trim();
        const year = parseInt(cols[1].replace(/"/g, '').trim());
        const lifeExpectancy = parseFloat(cols[2]);

        // ì¤‘ìœ„ ê°€ì •ë§Œ ì‚¬ìš©
        if (assumption === 'ì¤‘ìœ„' && !isNaN(year) && !isNaN(lifeExpectancy)) {
          data[year] = lifeExpectancy;
        }
      }

      console.log(`ê¸°ëŒ€ìˆ˜ëª… ë°ì´í„° ë¡œë“œ: ${Object.keys(data).length}ê°œ ì—°ë„`);
      return data;
    }

    /**
     * íŠ¹ì • ë‚˜ì´ì˜ ì‚¬ìš©ìê°€ 65ì„¸ê°€ ë˜ëŠ” í•´ì˜ ê¸°ëŒ€ìˆ˜ëª… ê³„ì‚°
     * @param {number} currentAge - í˜„ì¬ ë‚˜ì´
     * @returns {number} ê¸°ëŒ€ìˆ˜ëª… (ë°˜ì˜¬ë¦¼)
     */
    function getExpectedLifespan(currentAge) {
      const currentYear = new Date().getFullYear();
      const startAge = APP_DATA?.receiving?.start_age ?? DEFAULT_DATA.receiving.start_age;
      const yearsToRetirement = startAge - currentAge;
      const retirementYear = currentYear + yearsToRetirement;

      // í•´ë‹¹ ì—°ë„ì˜ ê¸°ëŒ€ìˆ˜ëª… ì°¾ê¸°
      let lifeExpectancy = LIFE_EXPECTANCY_DATA[retirementYear];

      // ì—†ìœ¼ë©´ ê°€ì¥ ê°€ê¹Œìš´ ì—°ë„ ì‚¬ìš©
      if (!lifeExpectancy) {
        const years = Object.keys(LIFE_EXPECTANCY_DATA).map(Number).sort((a, b) => a - b);
        if (retirementYear < years[0]) {
          lifeExpectancy = LIFE_EXPECTANCY_DATA[years[0]];
        } else if (retirementYear > years[years.length - 1]) {
          lifeExpectancy = LIFE_EXPECTANCY_DATA[years[years.length - 1]];
        } else {
          // ê°€ì¥ ê°€ê¹Œìš´ ì—°ë„ ì°¾ê¸°
          const closest = years.reduce((prev, curr) =>
            Math.abs(curr - retirementYear) < Math.abs(prev - retirementYear) ? curr : prev
          );
          lifeExpectancy = LIFE_EXPECTANCY_DATA[closest];
        }
      }

      return Math.round(lifeExpectancy || 85);
    }

    /**
     * data.jsonì„ ë¹„ë™ê¸°ë¡œ ë¡œë“œí•˜ê³  ì „ì—­ ë³€ìˆ˜ì— ì €ì¥
     * @returns {Promise<Object>} ë¡œë“œëœ ë°ì´í„° ë˜ëŠ” ê¸°ë³¸ê°’
     */
    async function loadData() {
      try {
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 5000);

        const response = await fetch('./data.json', {
          signal: controller.signal
        });
        clearTimeout(timeoutId);

        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }

        const data = await response.json();
        APP_DATA = validateData(data);
        console.log('ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', APP_DATA.updated_at);
        return APP_DATA;
      } catch (error) {
        if (error.name === 'AbortError') {
          console.warn('data.json ë¡œë“œ íƒ€ì„ì•„ì›ƒ (5ì´ˆ), ê¸°ë³¸ê°’ ì‚¬ìš©');
        } else {
          console.warn('data.json ë¡œë“œ ì‹¤íŒ¨, ê¸°ë³¸ê°’ ì‚¬ìš©:', error.message);
        }
        APP_DATA = { ...DEFAULT_DATA };
        return APP_DATA;
      }
    }

    /**
     * ëª¨ë“  ë°ì´í„° ë¡œë“œ (JSON + CSV)
     * @returns {Promise<void>}
     */
    async function loadAllData() {
      try {
        // ë³‘ë ¬ ë¡œë“œ
        const [_, bankProducts, inflationRate, lifeExpectancy] = await Promise.all([
          loadData(),
          loadPensionProducts(),
          loadInflationData(),
          loadLifeExpectancyData()
        ]);

        // ì „ì—­ ë³€ìˆ˜ ì„¤ì •
        BANK_PENSION_PRODUCTS = bankProducts || [];
        INFLATION_RATE = inflationRate || 0.025;
        LIFE_EXPECTANCY_DATA = lifeExpectancy || { 2025: 84.5 };

        // ì „ì²´ ìƒí’ˆ ëª©ë¡ ìƒì„± (ê¸°ì¡´ 3ê°œ + í€ë“œ ìƒí’ˆ)
        ALL_PENSION_PRODUCTS = [...PRIVATE_PENSION_PRODUCTS, ...BANK_PENSION_PRODUCTS];

        console.log(`ì „ì²´ ê°œì¸ì—°ê¸ˆ ìƒí’ˆ: ${ALL_PENSION_PRODUCTS.length}ê°œ`);
        console.log(`ê¸°ëŒ€ìˆ˜ëª… ë°ì´í„°: ${Object.keys(LIFE_EXPECTANCY_DATA).length}ê°œ ì—°ë„`);
      } catch (error) {
        console.error('loadAllData ì˜¤ë¥˜:', error);
        // ê¸°ë³¸ê°’ ì„¤ì •
        BANK_PENSION_PRODUCTS = [];
        INFLATION_RATE = 0.025;
        LIFE_EXPECTANCY_DATA = { 2025: 84.5 };
        ALL_PENSION_PRODUCTS = [...PRIVATE_PENSION_PRODUCTS];
      }
    }

    /**
     * ë°ì´í„° í•„ë“œ ê²€ì¦ ë° ê¸°ë³¸ê°’ ë³‘í•©
     * @param {Object} data - ë¡œë“œëœ JSON ë°ì´í„°
     * @returns {Object} ê²€ì¦ ë° ê¸°ë³¸ê°’ ë³‘í•©ëœ ë°ì´í„°
     */
    function validateData(data) {
      return {
        updated_at: data.updated_at || DEFAULT_DATA.updated_at,
        nps: { ...DEFAULT_DATA.nps, ...(data.nps || {}) },
        market: { ...DEFAULT_DATA.market, ...(data.market || {}) },
        wage_curve: { ...DEFAULT_DATA.wage_curve, ...(data.wage_curve || {}) },
        employment: { ...DEFAULT_DATA.employment, ...(data.employment || {}) },
        receiving: { ...DEFAULT_DATA.receiving, ...(data.receiving || {}) }
      };
    }

    /**
     * íŠ¹ì • ë°ì´í„° ì¡°íšŒ (ì  í‘œê¸°ë²•)
     * @param {string} path - ì  í‘œê¸°ë²• ê²½ë¡œ (ì˜ˆ: "nps.a_value")
     * @returns {*} í•´ë‹¹ ê²½ë¡œì˜ ê°’ ë˜ëŠ” undefined
     */
    function getData(path) {
      if (!APP_DATA || !path) return undefined;
      const keys = path.split('.');
      let value = APP_DATA;
      for (const key of keys) {
        if (value === null || value === undefined) return undefined;
        value = value[key];
      }
      return value;
    }

    /**
     * ê³„ì‚° ê¸°ëŠ¥ í™œì„±í™”
     * ë°ì´í„° ë¡œë“œ ì™„ë£Œ í›„ UI ìƒíƒœ ì—…ë°ì´íŠ¸
     */
    function enableCalculation() {
      const loadingStatus = document.getElementById('loading-status');
      const calculatorForm = document.getElementById('calculator-form');

      if (loadingStatus) {
        loadingStatus.innerHTML = `
          <span class="text-green-600">
            ë°ì´í„° ë¡œë“œ ì™„ë£Œ (${APP_DATA.updated_at} ê¸°ì¤€)
          </span>
        `;
      }

      if (calculatorForm) {
        calculatorForm.classList.remove('hidden');
      }
    }

    /**
     * í˜ì´ì§€ ì´ˆê¸°í™”
     */
    document.addEventListener('DOMContentLoaded', async () => {
      try {
        await loadAllData();
        enableCalculation();
        setupPensionSearch();
      } catch (error) {
        console.error('ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
        const loadingStatus = document.getElementById('loading-status');
        if (loadingStatus) {
          loadingStatus.innerHTML = `
            <span class="text-red-600">
              ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ${error.message}
            </span>
          `;
        }
        // ê¸°ë³¸ê°’ìœ¼ë¡œë¼ë„ ê³„ì‚° í¼ í™œì„±í™”
        APP_DATA = { ...DEFAULT_DATA };
        document.getElementById('calculator-form')?.classList.remove('hidden');
        setupPensionSearch();
      }
    });

    /**
     * ì—°ê¸ˆ ê²€ìƒ‰ ê¸°ëŠ¥ ì„¤ì •
     */
    function setupPensionSearch() {
      const searchInput = document.getElementById('pension-search');
      if (!searchInput) return;

      // ë””ë°”ìš´ìŠ¤ íƒ€ì´ë¨¸
      let debounceTimer = null;

      searchInput.addEventListener('input', (e) => {
        const query = e.target.value;

        // ê²€ìƒ‰ì–´ê°€ ë¹„ì–´ìˆìœ¼ë©´ ì¦‰ì‹œ ì „ì²´ í‘œì‹œ
        if (query.trim() === '') {
          clearTimeout(debounceTimer);
          renderReceivingTable(null, '');
          return;
        }

        // ë””ë°”ìš´ìŠ¤: 300ms ëŒ€ê¸° í›„ ê²€ìƒ‰ ì‹¤í–‰
        clearTimeout(debounceTimer);
        debounceTimer = setTimeout(() => {
          renderReceivingTable(null, query);
        }, 300);
      });

      // Enter í‚¤ë¡œ ì¦‰ì‹œ ê²€ìƒ‰
      searchInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          clearTimeout(debounceTimer);
          const query = e.target.value;
          renderReceivingTable(null, query);
        }
      });
    }

    // ============================================================
    // @CODE:CALC-001 | SPEC: SPEC-CALC-001/spec.md
    // ì„ê¸ˆ ìƒìŠ¹ ê³¡ì„  ê³„ì‚°
    // ============================================================

    /**
     * ì—°ë ¹ëŒ€ë³„ ì„ê¸ˆìƒìŠ¹ë¥  ì¡°íšŒ
     * @param {number} age - ë‚˜ì´
     * @returns {number} í•´ë‹¹ ì—°ë ¹ëŒ€ì˜ ì„ê¸ˆìƒìŠ¹ë¥ 
     */
    function getWageGrowthRate(age) {
      if (age < 30) return APP_DATA?.wage_curve?.['20s'] ?? 0.05;
      if (age < 40) return APP_DATA?.wage_curve?.['30s'] ?? 0.05;
      if (age < 50) return APP_DATA?.wage_curve?.['40s'] ?? 0.03;
      if (age < 55) return APP_DATA?.wage_curve?.['50s_early'] ?? 0.00;
      return APP_DATA?.wage_curve?.['50s_late'] ?? -0.02;
    }

    /**
     * ì—°ë ¹ë³„ ì˜ˆìƒ ì†Œë“ ê³„ì‚° (ì„ê¸ˆ ìƒìŠ¹ ê³¡ì„ )
     * - 30ì„¸ ë¯¸ë§Œ: ì…ë ¥í•œ ë‚˜ì´ë¶€í„° 60ì„¸ê¹Œì§€ ê³„ì‚°
     * - 30ì„¸ ì´ìƒ: 30ì„¸ë¶€í„° ê³¼ê±° ì†Œë“ ì—­ì‚° í›„ 60ì„¸ê¹Œì§€ ê³„ì‚°
     * @param {number} currentAge - í˜„ì¬ ë‚˜ì´ (20-59)
     * @param {number} currentIncome - í˜„ì¬ ì—°ì†Œë“ (ì›)
     * @returns {Array<{age: number, year: number, income: number}>} ì—°ë„ë³„ ì†Œë“ ë°°ì—´
     */
    function calculateWageCurve(currentAge, currentIncome) {
      // ì…ë ¥ ê²€ì¦
      if (currentAge < 20 || currentAge > 59) {
        console.warn('ë‚˜ì´ëŠ” 20-59ì„¸ ë²”ìœ„ì—¬ì•¼ í•©ë‹ˆë‹¤.');
        return [];
      }
      if (currentIncome <= 0) {
        console.warn('ì†Œë“ì€ ì–‘ìˆ˜ì—¬ì•¼ í•©ë‹ˆë‹¤.');
        return [];
      }

      const START_AGE = APP_DATA?.employment?.average_start_age ?? DEFAULT_DATA.employment.average_start_age;
      const currentYear = new Date().getFullYear();
      const result = [];

      // 30ì„¸ ë¯¸ë§Œì¸ ê²½ìš°: ì…ë ¥í•œ ë‚˜ì´ë¶€í„° 60ì„¸ê¹Œì§€ ê³„ì‚°
      if (currentAge < START_AGE) {
        let income = currentIncome;
        for (let age = currentAge; age <= 60; age++) {
          const year = currentYear + (age - currentAge);
          result.push({
            age,
            year,
            income: Math.round(income)
          });
          if (age < 60) {
            const growthRate = getWageGrowthRate(age);
            income = income * (1 + growthRate);
          }
        }
        return result;
      }

      // 30ì„¸ ì´ìƒì¸ ê²½ìš°: 30ì„¸ë¶€í„° ê³¼ê±° ì†Œë“ ì—­ì‚° í›„ ë¯¸ë˜ ì˜ˆì¸¡
      // í˜„ì¬ ì†Œë“ì—ì„œ 30ì„¸ ì†Œë“ ì—­ì‚°
      let income30 = currentIncome;
      for (let age = currentAge - 1; age >= START_AGE; age--) {
        const growthRate = getWageGrowthRate(age);
        income30 = income30 / (1 + growthRate);
      }

      // 30ì„¸ë¶€í„° 60ì„¸ê¹Œì§€ ìˆœì°¨ ê³„ì‚°
      let income = income30;
      for (let age = START_AGE; age <= 60; age++) {
        const year = currentYear - (currentAge - age);
        result.push({
          age,
          year,
          income: Math.round(income)
        });
        if (age < 60) {
          const growthRate = getWageGrowthRate(age);
          income = income * (1 + growthRate);
        }
      }

      return result;
    }

    // ============================================================
    // @CODE:CALC-002 | SPEC: SPEC-CALC-002/spec.md
    // êµ­ë¯¼ì—°ê¸ˆ ì˜ˆìƒ ìˆ˜ë ¹ì•¡ ê³„ì‚°
    // ============================================================

    /** êµ­ë¯¼ì—°ê¸ˆ ìƒìˆ˜ */
    const NPS_CONSTANTS = {
      FULL_MONTHS: 480           // 40ë…„ = 480ê°œì›” (ë§Œì•¡ ê¸°ì¤€)
    };

    /**
     * ì—°ë„ë³„ êµ­ë¯¼ì—°ê¸ˆ ë³´í—˜ë£Œìœ¨ ë°˜í™˜ (2026ë…„ ê°œì • ë°˜ì˜)
     * - 2025ë…„ ì´ì „: 9%
     * - 2026ë…„: 9.5%
     * - ë§¤ë…„ 0.5%ì”© ì¸ìƒ
     * - 2033ë…„ ì´í›„: 13%
     * @param {number} year - ì—°ë„
     * @returns {number} ë³´í—˜ë£Œìœ¨ (ì˜ˆ: 0.09, 0.095, ...)
     */
    function getContributionRate(year) {
      const rates = APP_DATA?.nps?.contribution_rates ?? DEFAULT_DATA.nps.contribution_rates;
      if (year <= 2025) return 0.09;
      if (year >= 2033) return 0.13;
      return rates[year] ?? 0.09;
    }

    /**
     * ê¸°ì¤€ì†Œë“ì›”ì•¡ ì‚°ì • (ìƒí•˜í•œ ì ìš©)
     * @param {number} annualIncome - ì—°ì†Œë“
     * @returns {number} ì›” ê¸°ì¤€ì†Œë“ (ìƒí•˜í•œ ì ìš©)
     */
    function getStandardMonthlyIncome(annualIncome) {
      const monthlyIncome = annualIncome / 12;
      const max = APP_DATA?.nps?.max_monthly_income ?? 5900000;
      const min = APP_DATA?.nps?.min_monthly_income ?? 370000;
      return Math.max(min, Math.min(max, monthlyIncome));
    }

    /**
     * êµ­ë¯¼ì—°ê¸ˆ ì˜ˆìƒ ì›” ìˆ˜ë ¹ì•¡ ê³„ì‚°
     * @param {Array<{age: number, income: number, year: number}>} incomes - ì—°ë„ë³„ ì†Œë“ ë°°ì—´
     * @param {string} jobType - ì§ì—… ìœ í˜• ('laborer' | 'business')
     * @returns {{
     *   monthlyBenefit: number,
     *   totalContribution: number,
     *   selfContribution: number,
     *   employerContribution: number
     * }}
     */
    function calculateNPS(incomes, jobType = 'laborer') {
      if (!incomes || incomes.length === 0) {
        return {
          monthlyBenefit: 0,
          totalContribution: 0,
          selfContribution: 0,
          employerContribution: 0
        };
      }

      const aValue = APP_DATA?.nps?.a_value ?? 2989352;
      const replacementRate = APP_DATA?.nps?.replacement_rate ?? 0.43;

      // Bê°’ ê³„ì‚°: ë³¸ì¸ì˜ ê¸°ì¤€ì†Œë“ì›”ì•¡ í‰ê· 
      let totalStandardIncome = 0;
      let selfContribution = 0;
      let employerContribution = 0;

      for (const item of incomes) {
        const standardMonthly = getStandardMonthlyIncome(item.income);
        totalStandardIncome += standardMonthly * 12;

        // ì—°ë„ë³„ ë³´í—˜ë£Œìœ¨ ì ìš© (2026ë…„ ê°œì • ë°˜ì˜)
        const year = item.year ?? new Date().getFullYear();
        const contributionRate = getContributionRate(year);
        const annualContribution = standardMonthly * 12 * contributionRate;

        if (jobType === 'laborer') {
          selfContribution += annualContribution / 2;
          employerContribution += annualContribution / 2;
        } else {
          selfContribution += annualContribution;
        }
      }

      const bValue = totalStandardIncome / incomes.length; // ì—°í‰ê·  ê¸°ì¤€ì†Œë“
      const contributionMonths = incomes.length * 12;

      // êµ­ë¯¼ì—°ê¸ˆ ì‚°ì‹ (ê°„ì†Œí™”): (A + B) Ã— ì†Œë“ëŒ€ì²´ìœ¨ Ã— ê°€ì…ì›”ìˆ˜/480 / 12
      const monthlyBenefit = Math.round(
        ((aValue + bValue) * replacementRate * (contributionMonths / NPS_CONSTANTS.FULL_MONTHS)) / 12
      );

      return {
        monthlyBenefit,
        totalContribution: Math.round(selfContribution + employerContribution),
        selfContribution: Math.round(selfContribution),
        employerContribution: Math.round(employerContribution)
      };
    }

    // ============================================================
    // @CODE:CALC-003 | SPEC: SPEC-CALC-003/spec.md
    // ê°œì¸ì—°ê¸ˆ ë³µë¦¬ ê³„ì‚°
    // ============================================================

    /** ê°œì¸ì—°ê¸ˆ ìƒí’ˆ ì •ë³´ (ì‹¤ì œ ìˆ˜ìµë¥  ê¸°ë°˜) */
    const PRIVATE_PENSION_PRODUCTS = [
      // returnYears: ê³¼ê±° ì‹¤ì  ê¸°ê°„, futureReturn: ë¯¸ë˜ ì˜ˆìƒ ìˆ˜ìµë¥ 
      { id: 'sp500', name: 'S&P500 ETF', return: 0.10, returnYears: 10, futureReturn: FUTURE_RETURN_RATE, fee: 0.0003 },
      { id: 'tdf2050', name: 'TDF 2050', return: 0.05, returnYears: 10, futureReturn: FUTURE_RETURN_RATE, fee: 0.005 },
      { id: 'savings', name: 'ì˜ˆê¸ˆí˜•', return: 0.025, returnYears: 10, futureReturn: 0.025, fee: 0 }  // ì˜ˆê¸ˆí˜•ì€ ë¯¸ë˜ë„ ë™ì¼
    ];

    /**
     * ë‹¨ì¼ ìƒí’ˆ ê°œì¸ì—°ê¸ˆ ê³„ì‚°
     * @param {Array<{age: number, income: number, year: number}>} incomes - ì—°ë„ë³„ ì†Œë“ ë°°ì—´
     * @param {Object} product - ìƒí’ˆ ì •ë³´
     * @param {string} [jobType='laborer'] - ì§ì—… ìœ í˜•
     * @returns {Object} ê³„ì‚° ê²°ê³¼
     */
    function calculateSinglePrivatePension(incomes, product, jobType = 'laborer') {
      if (!incomes || incomes.length === 0) {
        return {
          productId: product.id,
          productName: product.name,
          totalContribution: 0,
          totalBalance: 0,
          monthlyBenefit: 0
        };
      }

      // ê³¼ê±° ìˆ˜ìµë¥  (ì‹¤ì  ë°ì´í„°)
      const pastReturn = product.return - product.fee;
      // ë¯¸ë˜ ìˆ˜ìµë¥  (ìƒìœ„ 500ê°œ í€ë“œ í‰ê· )
      const futureReturn = (product.futureReturn ?? FUTURE_RETURN_RATE) - product.fee;
      // ê³¼ê±° ë°ì´í„° ê¸°ê°„ (ë…„)
      const returnYears = product.returnYears ?? 10;

      let totalContribution = 0;
      let balance = 0;
      let pastYearsUsed = 0;  // ê³¼ê±° ìˆ˜ìµë¥  ì ìš© ì—°ìˆ˜
      let futureYearsUsed = 0;  // ë¯¸ë˜ ìˆ˜ìµë¥  ì ìš© ì—°ìˆ˜

      for (let i = 0; i < incomes.length; i++) {
        const item = incomes[i];
        // ì—°ë„ë³„ ë³´í—˜ë£Œìœ¨ ì ìš© (2026ë…„ ê°œì • ë°˜ì˜)
        // ê°œì¸ì—°ê¸ˆ ë‚©ì…ì•¡ = êµ­ë¯¼ì—°ê¸ˆ ë³¸ì¸ ë¶€ë‹´ë¶„ê³¼ ë™ì¼
        const year = item.year ?? new Date().getFullYear();
        const fullContributionRate = getContributionRate(year);
        // ê·¼ë¡œìëŠ” ë³¸ì¸ ë¶€ë‹´ë¶„(ì ˆë°˜), ì‚¬ì—…ìëŠ” ì „ì•¡
        const selfContributionRate = jobType === 'laborer' ? fullContributionRate / 2 : fullContributionRate;

        // ê¸°ì¤€ì†Œë“ì›”ì•¡ ê¸°ì¤€ ë‚©ì… (êµ­ë¯¼ì—°ê¸ˆê³¼ ë™ì¼)
        const standardMonthly = getStandardMonthlyIncome(item.income);
        const annualContribution = standardMonthly * 12 * selfContributionRate;

        // ê³¼ê±°/ë¯¸ë˜ ìˆ˜ìµë¥  êµ¬ë¶„: ì²˜ìŒ returnYears ë…„ì€ ê³¼ê±° ìˆ˜ìµë¥ , ì´í›„ëŠ” ë¯¸ë˜ ìˆ˜ìµë¥ 
        const effectiveReturn = i < returnYears ? pastReturn : futureReturn;
        if (i < returnYears) {
          pastYearsUsed++;
        } else {
          futureYearsUsed++;
        }

        // ë³µë¦¬ ê³„ì‚°: ì´ì „ ì”ì•¡ì— ìˆ˜ìµë¥  ì ìš© í›„ ë‹¹í•´ ë‚©ì…ì•¡ ì¶”ê°€
        balance = balance * (1 + effectiveReturn) + annualContribution;
        totalContribution += annualContribution;
      }

      // ì›” ì˜ˆìƒ ìˆ˜ë ¹ì•¡ (20ë…„ ë¶„í• )
      const monthlyBenefit = Math.round(balance / (20 * 12));

      return {
        productId: product.id,
        productName: product.name,
        return: product.return,
        futureReturn: product.futureReturn ?? FUTURE_RETURN_RATE,
        returnYears: returnYears,
        pastYearsUsed: pastYearsUsed,
        futureYearsUsed: futureYearsUsed,
        fee: product.fee,
        totalContribution: Math.round(totalContribution),
        totalBalance: Math.round(balance),
        monthlyBenefit
      };
    }

    /**
     * ê°œì¸ì—°ê¸ˆ ì˜ˆìƒ ì ë¦½ì•¡ ê³„ì‚° (ì—¬ëŸ¬ ìƒí’ˆ)
     * @param {Array<{age: number, income: number}>} incomes - ì—°ë„ë³„ ì†Œë“ ë°°ì—´
     * @param {Object} [product] - íŠ¹ì • ìƒí’ˆ (ë¯¸ì§€ì • ì‹œ ì „ì²´)
     * @param {boolean} [useAllProducts=true] - ì „ì²´ ìƒí’ˆ ì‚¬ìš© ì—¬ë¶€ (CSV í¬í•¨)
     * @param {string} [jobType='laborer'] - ì§ì—… ìœ í˜•
     * @returns {Array} ìƒí’ˆë³„ ê³„ì‚° ê²°ê³¼
     */
    function calculatePrivatePension(incomes, product = null, useAllProducts = true, jobType = 'laborer') {
      if (product) {
        return [calculateSinglePrivatePension(incomes, product, jobType)];
      }

      // ì „ì²´ ìƒí’ˆ ì‚¬ìš© ì‹œ ALL_PENSION_PRODUCTS (ê¸°ì¡´ 3ê°œ + ì€í–‰ 35ê°œ)
      const products = useAllProducts && ALL_PENSION_PRODUCTS.length > 0
        ? ALL_PENSION_PRODUCTS
        : PRIVATE_PENSION_PRODUCTS;

      return products.map(p => calculateSinglePrivatePension(incomes, p, jobType));
    }

    // ============================================================
    // @CODE:CALC-004 | SPEC: SPEC-CALC-004/spec.md (ì‹ ê·œ)
    // 60-80ì„¸ ìˆ˜ë ¹ì•¡ ê³„ì‚° + ë¬¼ê°€ ì—°ë™
    // ============================================================

    /**
     * êµ­ë¯¼ì—°ê¸ˆ ë¬¼ê°€ì—°ë™ ìˆ˜ë ¹ì•¡ ê³„ì‚° (60-80ì„¸)
     * êµ­ë¯¼ì—°ê¸ˆì€ ë§¤ë…„ ë¬¼ê°€ìƒìŠ¹ë¥ ë§Œí¼ ìˆ˜ë ¹ì•¡ ì¸ìƒ
     * @param {number} baseMonthlyBenefit - 65ì„¸ ê¸°ì¤€ ì›” ìˆ˜ë ¹ì•¡
     * @param {number} [inflationRate] - ë¬¼ê°€ìƒìŠ¹ë¥  (ê¸°ë³¸ê°’: CSVì—ì„œ ë¡œë“œ)
     * @param {number} [expectedLifespan] - ê¸°ëŒ€ìˆ˜ëª… (ê¸°ë³¸ê°’: ì„¤ì •ê°’)
     * @returns {Array<{age: number, monthlyBenefit: number, realValue: number}>}
     */
    function calculateNPSWithInflation(baseMonthlyBenefit, inflationRate = INFLATION_RATE, expectedLifespan = null) {
      const startAge = APP_DATA?.receiving?.start_age ?? DEFAULT_DATA.receiving.start_age;
      const endAge = expectedLifespan || (APP_DATA?.receiving?.end_age ?? DEFAULT_DATA.receiving.end_age);
      const years = endAge - startAge;
      const results = [];
      let currentBenefit = baseMonthlyBenefit;

      for (let year = 0; year <= years; year++) {
        results.push({
          age: startAge + year,
          monthlyBenefit: Math.round(currentBenefit),
          realValue: Math.round(currentBenefit) // êµ­ë¯¼ì—°ê¸ˆì€ ë¬¼ê°€ì—°ë™ì´ë¯€ë¡œ ì‹¤ì§ˆê°€ì¹˜ ìœ ì§€
        });
        // ë§¤ë…„ ë¬¼ê°€ìƒìŠ¹ë¥ ë§Œí¼ ì¸ìƒ
        currentBenefit *= (1 + inflationRate);
      }

      return results;
    }

    /**
     * ê°œì¸ì—°ê¸ˆ ìˆ˜ë ¹ì•¡ ê³„ì‚° (65ì„¸~ê¸°ëŒ€ìˆ˜ëª…)
     * ê°œì¸ì—°ê¸ˆì€ ê³ ì • ìˆ˜ë ¹ì•¡, ì‹¤ì§ˆê°€ì¹˜ í•˜ë½
     * @param {number} totalBalance - ì´ ì ë¦½ì•¡
     * @param {number} [inflationRate] - ë¬¼ê°€ìƒìŠ¹ë¥  (ê¸°ë³¸ê°’: CSVì—ì„œ ë¡œë“œ)
     * @param {number} [expectedLifespan] - ê¸°ëŒ€ìˆ˜ëª… (ê¸°ë³¸ê°’: ì„¤ì •ê°’)
     * @returns {Array<{age: number, monthlyBenefit: number, realValue: number}>}
     */
    function calculatePrivatePensionReceiving(totalBalance, inflationRate = INFLATION_RATE, expectedLifespan = null) {
      const startAge = APP_DATA?.receiving?.start_age ?? DEFAULT_DATA.receiving.start_age;
      const endAge = expectedLifespan || (APP_DATA?.receiving?.end_age ?? DEFAULT_DATA.receiving.end_age);
      const years = endAge - startAge;
      const fixedMonthly = Math.round(totalBalance / ((years + 1) * 12));
      const results = [];

      for (let year = 0; year <= years; year++) {
        // ëª…ëª© ê¸ˆì•¡ì€ ê³ ì •, ì‹¤ì§ˆ ê°€ì¹˜ëŠ” ë§¤ë…„ ë¬¼ê°€ìƒìŠ¹ë¥ ë§Œí¼ í•˜ë½
        const realValue = fixedMonthly / Math.pow(1 + inflationRate, year);
        results.push({
          age: startAge + year,
          monthlyBenefit: fixedMonthly,
          realValue: Math.round(realValue)
        });
      }

      return results;
    }

    // ============================================================
    // @CODE:UI-002 | SPEC: SPEC-UI-002/spec.md
    // ê²°ê³¼ í…Œì´ë¸” ë¡œì§
    // ============================================================

    /**
     * ìˆ«ìë¥¼ í•œêµ­ ì›í™” í˜•ì‹ìœ¼ë¡œ í¬ë§·
     * @param {number} amount - ê¸ˆì•¡
     * @param {string} unit - ë‹¨ìœ„ ('ì›' | 'ë§Œì›')
     * @returns {string} í¬ë§·ëœ ê¸ˆì•¡
     */
    function formatCurrency(amount, unit = 'ë§Œì›') {
      if (amount === 0 || amount === null || amount === undefined) {
        return '-';
      }

      if (unit === 'ë§Œì›') {
        const manwon = Math.round(amount / 10000);
        return manwon.toLocaleString('ko-KR') + 'ë§Œì›';
      }

      return amount.toLocaleString('ko-KR') + 'ì›';
    }

    /**
     * ìš”ì•½ ì¹´ë“œ ë Œë”ë§
     * @param {Object} result - ê³„ì‚° ê²°ê³¼ ê°ì²´
     */
    function renderSummaryCards(result) {
      const grid = document.getElementById('summary-grid');
      if (!grid) return;

      const startAge = APP_DATA?.receiving?.start_age ?? DEFAULT_DATA.receiving.start_age;
      const expectedLifespan = result.expectedLifespan;
      const receivingYears = expectedLifespan - startAge;
      const currentYear = new Date().getFullYear();
      const retirementYear = currentYear + (startAge - result.incomes[0]?.age || 0);

      // ì œëª© ë° ê¸°ëŒ€ìˆ˜ëª… ì •ë³´ ì—…ë°ì´íŠ¸
      const summaryTitle = document.getElementById('summary-title');
      if (summaryTitle) {
        summaryTitle.textContent = `65ì„¸~${expectedLifespan}ì„¸ ì˜ˆìƒ ì´ ìˆ˜ë ¹ì•¡ ë¹„êµ`;
      }

      const lifeExpectancyInfo = document.getElementById('life-expectancy-info');
      if (lifeExpectancyInfo) {
        lifeExpectancyInfo.innerHTML = `ğŸ“Š ${retirementYear}ë…„(65ì„¸) ê¸°ì¤€ ê¸°ëŒ€ìˆ˜ëª… <strong>${expectedLifespan}ì„¸</strong> Â· ìˆ˜ë ¹ ê¸°ê°„ <strong>${receivingYears}ë…„</strong>`;
      }

      // êµ­ë¯¼ì—°ê¸ˆ 65ì„¸ ì‹œì  ì›” ìˆ˜ë ¹ì•¡ (ìˆ˜ë ¹ì•¡ í…Œì´ë¸”ê³¼ ë™ì¼í•œ ë°ì´í„° ì‚¬ìš©)
      const nps65 = result.nps.receiving.find(r => r.age === startAge);
      const npsMonthlyAt65 = nps65?.monthlyBenefit || 0;
      const npsTaxAt65 = calculateNPSTax(npsMonthlyAt65);

      // êµ­ë¯¼ì—°ê¸ˆ ì´ ìˆ˜ë ¹ì•¡ (65ì„¸~ê¸°ëŒ€ìˆ˜ëª…)
      const npsTotalReceiving = result.nps.receiving.reduce((sum, r) => sum + r.monthlyBenefit * 12, 0);

      // ìƒìœ„ 3ê°œ ê°œì¸ì—°ê¸ˆ (65ì„¸ ì‹œì  ì›” ìˆ˜ë ¹ì•¡ ê¸°ì¤€ ì •ë ¬)
      const topPensions = result.privatePensions
        .slice()
        .map(pp => {
          const pp65 = pp.receiving.find(r => r.age === startAge);
          const monthlyAt65 = pp65?.monthlyBenefit || 0;
          const taxAt65 = calculatePrivatePensionTax(monthlyAt65, startAge);
          const totalReceiving = pp.receiving.reduce((sum, r) => sum + r.monthlyBenefit * 12, 0);
          return { ...pp, monthlyAt65, netAmountAt65: taxAt65.netAmount, totalReceiving };
        })
        .sort((a, b) => b.netAmountAt65 - a.netAmountAt65)
        .slice(0, 3);

      const cards = [
        {
          title: 'êµ­ë¯¼ì—°ê¸ˆ',
          amount: npsTaxAt65.netAmount,
          totalReceiving: npsTotalReceiving,
          color: 'blue',
          tooltip: `ì„¸ì „: ${formatCurrency(npsMonthlyAt65)}\nì´ ìˆ˜ë ¹ì•¡: ${formatCurrency(npsTotalReceiving)}`
        },
        ...topPensions.map((pp, index) => ({
          title: pp.productName.length > 12 ? pp.productName.substring(0, 12) + '...' : pp.productName,
          amount: pp.netAmountAt65,
          totalReceiving: pp.totalReceiving,
          color: index === 0 ? 'green' : index === 1 ? 'purple' : 'gray',
          tooltip: `${pp.productName}\nì„¸ì „: ${formatCurrency(pp.monthlyAt65)}\nìˆ˜ìµë¥ : ${((pp.return || 0) * 100).toFixed(1)}%\nì´ ìˆ˜ë ¹ì•¡: ${formatCurrency(pp.totalReceiving)}`
        }))
      ];

      grid.innerHTML = cards.map(card => `
        <div class="bg-${card.color}-50 border border-${card.color}-200 rounded-lg p-4 text-center"
             title="${card.tooltip}">
          <div class="text-sm text-${card.color}-600 font-medium mb-2">${card.title}</div>
          <div class="text-2xl font-bold text-${card.color}-800">${formatCurrency(card.totalReceiving)}</div>
          <div class="text-xs text-${card.color}-500 mt-1">ì´ ìˆ˜ë ¹ì•¡</div>
          <div class="text-xs text-${card.color}-400 mt-2 pt-2 border-t border-${card.color}-200">
            ì›” ${formatCurrency(card.amount)} (65ì„¸ ê¸°ì¤€)
          </div>
        </div>
      `).join('');
    }

    /**
     * ê²°ê³¼ í…Œì´ë¸” ë Œë”ë§
     * @param {Object} result - ê³„ì‚° ê²°ê³¼ ê°ì²´
     */
    function renderResultTable(result) {
      // ìš”ì•½ ì¹´ë“œ ë Œë”ë§
      renderSummaryCards(result);

      const table = document.getElementById('result-table');
      if (!table) return;

      const incomes = result.incomes;
      const jobType = result.formData.jobType;

      // ë‚©ì…ê¸ˆ ì´ì•¡ ê³„ì‚°
      const npsTotalContribution = result.nps.totalContribution;
      const npsSelfContribution = result.nps.selfContribution;
      const npsEmployerContribution = result.nps.employerContribution;

      // ê°œì¸ì—°ê¸ˆ ì´ ë‚©ì…ì•¡ ê³„ì‚° (êµ­ë¯¼ì—°ê¸ˆ ê°œì¸ ë‚©ì…ë¶„ê³¼ ë™ì¼, ì—°ë„ë³„ ë³´í—˜ë£Œìœ¨ ì ìš©)
      let privateTotalContribution = 0;
      for (const item of incomes) {
        const standardMonthly = getStandardMonthlyIncome(item.income);
        const yearRate = getContributionRate(item.year);
        const selfRate = jobType === 'laborer' ? yearRate / 2 : yearRate;
        privateTotalContribution += standardMonthly * 12 * selfRate;
      }
      privateTotalContribution = Math.round(privateTotalContribution);

      // í—¤ë” í–‰ ìƒì„±
      let headerRow = '<tr class="bg-gray-100">';
      headerRow += '<th class="px-3 py-2 text-left font-medium text-gray-700 sticky left-0 bg-gray-100 min-w-[140px]">í•­ëª©</th>';
      headerRow += '<th class="px-3 py-2 text-center font-medium text-gray-700 min-w-[140px]">ë‚©ì…ê¸ˆ ì´ì•¡</th>';
      for (const item of incomes) {
        headerRow += `<th class="px-3 py-2 text-center font-medium text-gray-700 min-w-[120px]">${item.year}ë…„<br><span class="text-xs text-gray-500">(${item.age}ì„¸)</span></th>`;
      }
      headerRow += '</tr>';

      // ì˜ˆìƒ ì†Œë“ í–‰
      let incomeRow = '<tr class="border-b">';
      incomeRow += '<td class="px-3 py-2 font-medium text-gray-700 sticky left-0 bg-white">ì˜ˆìƒ ì†Œë“</td>';
      incomeRow += '<td class="px-3 py-2 text-center text-gray-400">-</td>';
      for (const item of incomes) {
        const monthly = Math.round(item.income / 12);
        incomeRow += `<td class="px-3 py-2 text-center text-gray-600">${formatCurrency(item.income)}<br><span class="text-xs text-gray-500">(ì›” ${formatCurrency(monthly)})</span></td>`;
      }
      incomeRow += '</tr>';

      // êµ­ë¯¼ì—°ê¸ˆ ë‚©ì…ì•¡ í–‰
      let npsContribRow = '<tr class="border-b bg-blue-50">';
      npsContribRow += '<td class="px-3 py-2 font-medium text-blue-700 sticky left-0 bg-blue-50">êµ­ë¯¼ì—°ê¸ˆ ë‚©ì…</td>';
      npsContribRow += `<td class="px-3 py-2 text-center bg-blue-100">
        <span class="font-bold text-blue-800">${formatCurrency(npsTotalContribution)}</span>
        <br><span class="text-xs text-blue-600">(ë³¸ì¸ ${formatCurrency(npsSelfContribution)}${jobType === 'laborer' ? `<br>+íšŒì‚¬ ${formatCurrency(npsEmployerContribution)}` : ''})</span>
      </td>`;
      for (const item of incomes) {
        const standardMonthly = getStandardMonthlyIncome(item.income);
        // ì—°ë„ë³„ ë³´í—˜ë£Œìœ¨ ì ìš© (2026ë…„ ê°œì • ë°˜ì˜)
        const yearRate = getContributionRate(item.year);
        const selfRate = jobType === 'laborer' ? yearRate / 2 : yearRate;
        const selfMonthly = standardMonthly * selfRate;
        const annualContrib = selfMonthly * 12;
        const employerMonthly = jobType === 'laborer' ? selfMonthly : 0;
        const employerAnnual = employerMonthly * 12;

        // ë³´í—˜ë£Œìœ¨ í‘œì‹œ (ì—°ë„ë³„ ë³€ë™ ì‹œ ì¶”ê°€ í‘œì‹œ)
        const rateDisplay = yearRate !== 0.09 ? `<br><span class="text-xs text-blue-400">(ìš”ìœ¨ ${(yearRate * 100).toFixed(1)}%)</span>` : '';
        let cellContent = `${formatCurrency(annualContrib)}<br><span class="text-xs">(ì›” ${formatCurrency(selfMonthly)})</span>${rateDisplay}`;
        if (jobType === 'laborer') {
          cellContent += `<br><span class="text-xs text-blue-500">(+íšŒì‚¬ ${formatCurrency(employerAnnual)})</span>`;
        }
        npsContribRow += `<td class="px-3 py-2 text-center text-blue-600">${cellContent}</td>`;
      }
      npsContribRow += '</tr>';

      // ê°œì¸ì—°ê¸ˆ ë‚©ì…ì•¡ í–‰ (êµ­ë¯¼ì—°ê¸ˆ ê°œì¸ ë‚©ì…ë¶„ê³¼ ë™ì¼)
      let privateContribRow = '<tr class="border-b bg-green-50">';
      privateContribRow += '<td class="px-3 py-2 font-medium text-green-700 sticky left-0 bg-green-50">ê°œì¸ì—°ê¸ˆ ë‚©ì…</td>';
      privateContribRow += `<td class="px-3 py-2 text-center bg-green-100">
        <span class="font-bold text-green-800">${formatCurrency(privateTotalContribution)}</span>
        <br><span class="text-xs text-green-600">(ë³¸ì¸ ë¶€ë‹´)</span>
      </td>`;
      for (const item of incomes) {
        const standardMonthly = getStandardMonthlyIncome(item.income);
        // ì—°ë„ë³„ ë³´í—˜ë£Œìœ¨ ì ìš© (2026ë…„ ê°œì • ë°˜ì˜)
        const yearRate = getContributionRate(item.year);
        const selfRate = jobType === 'laborer' ? yearRate / 2 : yearRate;
        const monthlyContrib = standardMonthly * selfRate;
        const annualContrib = monthlyContrib * 12;
        privateContribRow += `<td class="px-3 py-2 text-center text-green-600">${formatCurrency(annualContrib)}<br><span class="text-xs">(ì›” ${formatCurrency(monthlyContrib)})</span></td>`;
      }
      privateContribRow += '</tr>';

      table.innerHTML = `
        <thead>${headerRow}</thead>
        <tbody>
          ${incomeRow}
          ${npsContribRow}
          ${privateContribRow}
        </tbody>
      `;
    }

    // ë§ˆì§€ë§‰ ê³„ì‚° ê²°ê³¼ ì €ì¥ (ê²€ìƒ‰ í•„í„°ë§ìš©)
    let lastCalculationResult = null;

    /**
     * ìˆ˜ë ¹ì•¡ í…Œì´ë¸” ë Œë”ë§ (ì „ì²´ ìƒí’ˆ, ë§¤ë…„ í‘œì‹œ)
     * @param {Object} result - ê³„ì‚° ê²°ê³¼ ê°ì²´
     * @param {string} searchQuery - ê²€ìƒ‰ì–´ (ì„ íƒì )
     */
    function renderReceivingTable(result, searchQuery = '') {
      const table = document.getElementById('receiving-table');
      if (!table) return;

      // ê²°ê³¼ ì €ì¥ (ê²€ìƒ‰ í•„í„°ë§ìš©)
      if (result) {
        lastCalculationResult = result;
      } else if (lastCalculationResult) {
        result = lastCalculationResult;
      } else {
        return;
      }

      const npsReceiving = result.nps.receiving;
      const privatePensions = result.privatePensions;
      const expectedLifespan = result.expectedLifespan;

      // í…Œì´ë¸” ì œëª© ì—…ë°ì´íŠ¸ (ê¸°ëŒ€ìˆ˜ëª… ë°˜ì˜)
      const titleElement = document.getElementById('receiving-table-title');
      const startAge = APP_DATA?.receiving?.start_age ?? DEFAULT_DATA.receiving.start_age;
      const endAge = expectedLifespan || (APP_DATA?.receiving?.end_age ?? DEFAULT_DATA.receiving.end_age);
      if (titleElement) {
        titleElement.textContent = `${startAge}~${endAge}ì„¸ ì—°ê°„ ìˆ˜ë ¹ì•¡ ë¹„êµ (ê¸°ëŒ€ìˆ˜ëª… ${endAge}ì„¸)`;
      }

      // ì „ì²´ ìƒí’ˆ í‘œì‹œ (ìˆ˜ìµë¥  ìˆœ ì •ë ¬)
      let allProducts = privatePensions
        .slice()
        .sort((a, b) => b.tax.netAmount - a.tax.netAmount);

      // ê²€ìƒ‰ì–´ê°€ ìˆìœ¼ë©´ í•„í„°ë§
      const hasSearchQuery = searchQuery.trim().length > 0;
      if (hasSearchQuery) {
        const query = searchQuery.trim().toLowerCase();
        allProducts = allProducts.filter(pp =>
          pp.productName.toLowerCase().includes(query) ||
          (pp.bank && pp.bank.toLowerCase().includes(query))
        );
      }

      // ê²€ìƒ‰ ê²°ê³¼ ê°œìˆ˜ í‘œì‹œ
      const searchResultInfo = hasSearchQuery
        ? `<span class="text-sm text-blue-600 ml-2">(ê²€ìƒ‰ ê²°ê³¼: ${allProducts.length}ê°œ)</span>`
        : '';
      if (titleElement) {
        titleElement.innerHTML = `${startAge}~${endAge}ì„¸ ì—°ê°„ ìˆ˜ë ¹ì•¡ ë¹„êµ (ê¸°ëŒ€ìˆ˜ëª… ${endAge}ì„¸)${searchResultInfo}`;
      }

      // ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ ì²˜ë¦¬
      if (hasSearchQuery && allProducts.length === 0) {
        table.innerHTML = `
          <thead>
            <tr class="bg-gray-100">
              <th class="px-2 py-2 text-center font-medium text-gray-700">ì—°ë ¹</th>
              <th class="px-2 py-2 text-center font-medium text-blue-700">êµ­ë¯¼ì—°ê¸ˆ</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td colspan="2" class="px-4 py-8 text-center text-gray-500">
                <div class="flex flex-col items-center gap-2">
                  <svg class="w-12 h-12 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                  </svg>
                  <p>"${searchQuery}" ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                  <p class="text-xs">ìƒí’ˆëª… ë˜ëŠ” ê¸ˆìœµíšŒì‚¬ëª…ìœ¼ë¡œ ê²€ìƒ‰í•´ ë³´ì„¸ìš”.</p>
                </div>
              </td>
            </tr>
          </tbody>
        `;
        return;
      }

      // í—¤ë” í–‰ ìƒì„± (ì—°ë ¹, êµ­ë¯¼ì—°ê¸ˆ ì—´ ê³ ì •)
      let headerRow = '<tr class="bg-gray-100">';
      headerRow += '<th class="px-2 py-2 text-center font-medium text-gray-700 sticky left-0 z-20 bg-gray-100 min-w-[60px] border-r border-gray-200">ì—°ë ¹</th>';
      headerRow += '<th class="px-2 py-2 text-center font-medium text-blue-700 sticky left-[60px] z-20 bg-gray-100 min-w-[140px] border-r border-gray-300">êµ­ë¯¼ì—°ê¸ˆ<br><span class="text-xs">(ë¬¼ê°€ì—°ë™)</span></th>';
      for (const pp of allProducts) {
        const displayName = pp.productName.length > 12 ? pp.productName.substring(0, 12) + '...' : pp.productName;
        // ê³¼ê±°/ë¯¸ë˜ ìˆ˜ìµë¥  ì •ë³´ í‘œì‹œ
        const pastRate = ((pp.return || 0) * 100).toFixed(1);
        const futureRate = ((pp.futureReturn ?? FUTURE_RETURN_RATE) * 100).toFixed(1);
        const returnYears = pp.returnYears ?? 10;
        const returnInfo = pp.returnYears
          ? `${returnYears}ë…„ ${pastRate}% â†’ ${futureRate}%`
          : `ê³ ì • ${pastRate}%`;
        headerRow += `<th class="px-2 py-2 text-center font-medium text-gray-700 min-w-[160px]" title="${pp.productName}\nê³¼ê±° ${returnYears}ë…„ ìˆ˜ìµë¥ : ${pastRate}%\në¯¸ë˜ ì˜ˆìƒ ìˆ˜ìµë¥ : ${futureRate}%">${displayName}<br><span class="text-xs text-gray-500">(${returnInfo})</span></th>`;
      }
      headerRow += '</tr>';

      // ì—°ë„ ê³„ì‚°ì„ ìœ„í•œ í˜„ì¬ ë‚˜ì´ì™€ í˜„ì¬ ì—°ë„
      const currentAge = result.formData.currentAge;
      const currentYear = new Date().getFullYear();

      // ë°ì´í„° í–‰ ìƒì„± (65ì„¸~ê¸°ëŒ€ìˆ˜ëª… ë§¤ë…„)
      let dataRows = '';

      for (let age = startAge; age <= endAge; age++) {
        const npsData = npsReceiving.find(r => r.age === age);
        if (!npsData) continue;

        // í•´ë‹¹ ë‚˜ì´ê°€ ë˜ëŠ” ì—°ë„ ê³„ì‚°
        const yearAtAge = currentYear + (age - currentAge);

        const isHighlight = age === startAge || age === endAge;
        const rowClass = isHighlight ? 'bg-yellow-50' : (age % 5 === 0 ? 'bg-gray-50' : '');

        // í–‰ ë°°ê²½ìƒ‰ ê²°ì • (sticky ì…€ì—ë„ ë™ì¼í•˜ê²Œ ì ìš©)
        const bgColor = isHighlight ? 'bg-yellow-50' : (age % 5 === 0 ? 'bg-gray-50' : 'bg-white');

        dataRows += `<tr class="border-b ${rowClass}">`;
        dataRows += `<td class="px-2 py-2 text-center font-medium text-gray-700 sticky left-0 z-10 ${bgColor} min-w-[60px] border-r border-gray-200">${age}ì„¸<br><span class="text-xs text-gray-500">(${yearAtAge}ë…„)</span></td>`;

        // êµ­ë¯¼ì—°ê¸ˆ (ë¬¼ê°€ì—°ë™) - ì—°ê°„ + (ì›”)
        const npsAnnual = npsData.monthlyBenefit * 12;
        dataRows += `<td class="px-2 py-2 text-center text-blue-700 font-bold sticky left-[60px] z-10 ${bgColor} min-w-[140px] border-r border-gray-300">${formatCurrency(npsAnnual)}<br><span class="text-xs font-normal">(ì›” ${formatCurrency(npsData.monthlyBenefit)})</span></td>`;

        // ì „ì²´ ê°œì¸ì—°ê¸ˆ ìƒí’ˆë“¤
        for (const pp of allProducts) {
          const ppData = pp.receiving.find(r => r.age === age);
          const ppAnnual = (ppData?.monthlyBenefit || 0) * 12;
          dataRows += `<td class="px-2 py-2 text-center">
            <span class="text-gray-700">${formatCurrency(ppAnnual)}</span><br>
            <span class="text-xs">(ì›” ${formatCurrency(ppData?.monthlyBenefit || 0)})</span>
          </td>`;
        }

        dataRows += '</tr>';
      }

      // ì´ ìˆ˜ë ¹ì•¡ í–‰ (ìˆ˜ë ¹ ê¸°ê°„ì— ë”°ë¼ ë™ì  ê³„ì‚°)
      const years = endAge - startAge + 1;
      const totalNPS = npsReceiving.reduce((sum, r) => sum + r.monthlyBenefit * 12, 0);
      let totalRow = '<tr class="bg-gray-200 font-bold">';
      totalRow += `<td class="px-2 py-2 text-center text-gray-800 sticky left-0 z-10 bg-gray-200 min-w-[60px] border-r border-gray-200">${years}ë…„ ì´í•©</td>`;
      totalRow += `<td class="px-2 py-2 text-center text-blue-800 sticky left-[60px] z-10 bg-gray-200 min-w-[140px] border-r border-gray-300">${formatCurrency(totalNPS)}</td>`;

      for (const pp of allProducts) {
        const totalPP = pp.receiving.reduce((sum, r) => sum + r.monthlyBenefit * 12, 0);
        totalRow += `<td class="px-2 py-2 text-center text-gray-800">${formatCurrency(totalPP)}</td>`;
      }
      totalRow += '</tr>';

      table.innerHTML = `
        <thead>${headerRow}</thead>
        <tbody>
          ${dataRows}
          ${totalRow}
        </tbody>
      `;
    }

    // ============================================================
    // @CODE:UI-001 | SPEC: SPEC-UI-001/spec.md
    // ì…ë ¥ í¼ ë¡œì§
    // ============================================================

    /**
     * ì§ì—… êµ¬ë¶„ ì „í™˜ ì‹œ ì…ë ¥ í•„ë“œ í† ê¸€
     */
    function toggleJobType() {
      const laborerIncome = document.getElementById('laborer-income');
      const businessIncome = document.getElementById('business-income');
      const jobType = document.querySelector('input[name="jobType"]:checked')?.value;

      if (jobType === 'laborer') {
        laborerIncome?.classList.remove('hidden');
        businessIncome?.classList.add('hidden');
      } else {
        laborerIncome?.classList.add('hidden');
        businessIncome?.classList.remove('hidden');
      }
    }

    /**
     * í¼ ë°ì´í„° ìˆ˜ì§‘
     * @returns {{jobType: string, currentAge: number, currentIncome: number, isValid: boolean, errors: string[]}}
     */
    function getFormData() {
      const jobType = document.querySelector('input[name="jobType"]:checked')?.value || 'laborer';
      const currentAge = parseInt(document.getElementById('currentAge')?.value) || 0;

      let currentIncome = 0;
      if (jobType === 'laborer') {
        currentIncome = (parseInt(document.getElementById('annualSalary')?.value) || 0) * 10000;
      } else {
        currentIncome = (parseInt(document.getElementById('monthlyBusinessIncome')?.value) || 0) * 10000 * 12;
      }

      const validation = validateFormData({ jobType, currentAge, currentIncome });

      return {
        jobType,
        currentAge,
        currentIncome,
        isValid: validation.isValid,
        errors: validation.errors
      };
    }

    /**
     * í¼ ë°ì´í„° ê²€ì¦
     * @param {Object} data - í¼ ë°ì´í„°
     * @returns {{isValid: boolean, errors: string[]}}
     */
    function validateFormData(data) {
      const errors = [];

      if (data.currentAge < 20 || data.currentAge > 59) {
        errors.push('ë‚˜ì´ëŠ” 20-59ì„¸ ë²”ìœ„ì—¬ì•¼ í•©ë‹ˆë‹¤.');
      }

      if (data.currentIncome <= 0) {
        errors.push('ì†Œë“ì€ ì–‘ìˆ˜ì—¬ì•¼ í•©ë‹ˆë‹¤.');
      }

      return {
        isValid: errors.length === 0,
        errors
      };
    }

    /**
     * ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ
     * @param {string[]} errors - ì˜¤ë¥˜ ë©”ì‹œì§€ ë°°ì—´
     */
    function showErrors(errors) {
      const errorContainer = document.getElementById('error-message');
      if (errorContainer) {
        errorContainer.classList.remove('hidden');
        errorContainer.querySelector('p').textContent = errors.join(' ');
      }
    }

    /**
     * ì˜¤ë¥˜ ë©”ì‹œì§€ ìˆ¨ê¹€
     */
    function hideErrors() {
      const errorContainer = document.getElementById('error-message');
      if (errorContainer) {
        errorContainer.classList.add('hidden');
      }
    }

    /**
     * ë¡œë”© ìƒíƒœ í‘œì‹œ
     */
    function showLoading() {
      const btn = document.getElementById('calculate-btn');
      const btnText = document.getElementById('btn-text');
      const btnSpinner = document.getElementById('btn-spinner');

      if (btn) btn.disabled = true;
      if (btnText) btnText.textContent = 'ê³„ì‚° ì¤‘...';
      if (btnSpinner) btnSpinner.classList.remove('hidden');
    }

    /**
     * ë¡œë”© ìƒíƒœ í•´ì œ
     */
    function hideLoading() {
      const btn = document.getElementById('calculate-btn');
      const btnText = document.getElementById('btn-text');
      const btnSpinner = document.getElementById('btn-spinner');

      if (btn) btn.disabled = false;
      if (btnText) btnText.textContent = 'ê³„ì‚°í•˜ê¸°';
      if (btnSpinner) btnSpinner.classList.add('hidden');
    }

    /**
     * ê³„ì‚° ë²„íŠ¼ í´ë¦­ í•¸ë“¤ëŸ¬
     */
    function handleCalculate() {
      hideErrors();

      const formData = getFormData();

      if (!formData.isValid) {
        showErrors(formData.errors);
        return;
      }

      // ë¡œë”© í‘œì‹œ í›„ ì•½ê°„ì˜ ì§€ì—°ì„ ë‘ì–´ UI ì—…ë°ì´íŠ¸ ë³´ì¥
      showLoading();
      setTimeout(() => {
        try {
          executeCalculation(formData);
        } finally {
          hideLoading();
        }
      }, 50);
    }

    /**
     * ê³„ì‚° ì‹¤í–‰ ë° ê²°ê³¼ í‘œì‹œ
     * @param {Object} data - ê²€ì¦ëœ í¼ ë°ì´í„°
     */
    function executeCalculation(data) {
      // ì„ê¸ˆ ê³¡ì„  ê³„ì‚° (30ì„¸ë¶€í„°)
      const incomes = calculateWageCurve(data.currentAge, data.currentIncome);

      // ê¸°ëŒ€ìˆ˜ëª… ê³„ì‚° (ì…ë ¥í•œ ë‚˜ì´ ê¸°ì¤€)
      const expectedLifespan = getExpectedLifespan(data.currentAge);
      const startAge = APP_DATA?.receiving?.start_age ?? DEFAULT_DATA.receiving.start_age;

      // êµ­ë¯¼ì—°ê¸ˆ ê³„ì‚°
      const npsResult = calculateNPS(incomes, data.jobType);
      const npsTax = calculateNPSTax(npsResult.monthlyBenefit);

      // 65ì„¸ë¶€í„° ê¸°ëŒ€ìˆ˜ëª…ê¹Œì§€ êµ­ë¯¼ì—°ê¸ˆ ìˆ˜ë ¹ì•¡ (ë¬¼ê°€ì—°ë™)
      const npsReceiving = calculateNPSWithInflation(npsTax.netAmount, INFLATION_RATE, expectedLifespan);

      // ê°œì¸ì—°ê¸ˆ ê³„ì‚° (ì „ì²´ ìƒí’ˆ: ê¸°ì¡´ 3ê°œ + í€ë“œ ìƒí’ˆ)
      const privatePensionResults = calculatePrivatePension(incomes, null, true, data.jobType);
      const privatePensionWithTax = privatePensionResults.map(result => {
        const tax = calculatePrivatePensionTax(result.monthlyBenefit, startAge);
        // 65ì„¸ë¶€í„° ê¸°ëŒ€ìˆ˜ëª…ê¹Œì§€ ê°œì¸ì—°ê¸ˆ ìˆ˜ë ¹ì•¡ (ê³ ì •)
        const receiving = calculatePrivatePensionReceiving(result.totalBalance, INFLATION_RATE, expectedLifespan);
        return {
          ...result,
          tax,
          receiving
        };
      });

      // ê²°ê³¼ ì €ì¥ (UI-002ì—ì„œ ì‚¬ìš©)
      window.calculationResult = {
        formData: data,
        incomes,
        expectedLifespan,
        nps: { ...npsResult, tax: npsTax, receiving: npsReceiving },
        privatePensions: privatePensionWithTax,
        inflationRate: INFLATION_RATE
      };

      // ë¬¼ê°€ìƒìŠ¹ë¥  í‘œì‹œ ì—…ë°ì´íŠ¸
      const inflationDisplay = document.getElementById('inflation-rate-display');
      if (inflationDisplay) {
        inflationDisplay.textContent = `${(INFLATION_RATE * 100).toFixed(1)}%`;
      }

      // ê²°ê³¼ í…Œì´ë¸” í‘œì‹œ (UI-002 í•¨ìˆ˜ í˜¸ì¶œ)
      if (typeof renderResultTable === 'function') {
        renderResultTable(window.calculationResult);
      }

      // 60-80ì„¸ ìˆ˜ë ¹ í…Œì´ë¸” í‘œì‹œ
      if (typeof renderReceivingTable === 'function') {
        renderReceivingTable(window.calculationResult);
      }

      // ê²°ê³¼ ì»¨í…Œì´ë„ˆ í‘œì‹œ
      const resultContainer = document.getElementById('result-container');
      if (resultContainer) {
        resultContainer.classList.remove('hidden');
      }

      console.log('ê³„ì‚° ì™„ë£Œ:', window.calculationResult);
    }

    // ============================================================
    // @CODE:TAX-001 | SPEC: SPEC-TAX-001/spec.md
    // ì„¸ê¸ˆ ê³„ì‚° ë¡œì§
    // ============================================================

    /** êµ­ë¯¼ì—°ê¸ˆ ì„¸ê¸ˆ ìƒìˆ˜ */
    const NPS_TAX_CONSTANTS = {
      ANNUAL_EXEMPTION: 3500000,  // ì—°ê°„ ë¹„ê³¼ì„¸ í•œë„ (350ë§Œì›)
      TAX_RATE: 0.05             // ê°„ì†Œí™” ì„¸ìœ¨ 5%
    };

    /** ê°œì¸ì—°ê¸ˆ ì„¸ìœ¨ (ì—°ë ¹ë³„) */
    const PRIVATE_PENSION_TAX_RATES = {
      UNDER_70: 0.055,  // 70ì„¸ ë¯¸ë§Œ: 5.5%
      UNDER_80: 0.044,  // 70~79ì„¸: 4.4%
      OVER_80: 0.033    // 80ì„¸ ì´ìƒ: 3.3%
    };

    /**
     * êµ­ë¯¼ì—°ê¸ˆ ì„¸ê¸ˆ ê³„ì‚° (ê°„ì´ì„¸ì•¡í‘œ ê°„ì†Œí™”)
     * @param {number} monthlyBenefit - ì›” ìˆ˜ë ¹ì•¡
     * @returns {{grossAmount: number, taxAmount: number, netAmount: number}}
     */
    function calculateNPSTax(monthlyBenefit) {
      if (!monthlyBenefit || monthlyBenefit <= 0) {
        return { grossAmount: 0, taxAmount: 0, netAmount: 0 };
      }

      const annualBenefit = monthlyBenefit * 12;
      const taxableAmount = Math.max(0, annualBenefit - NPS_TAX_CONSTANTS.ANNUAL_EXEMPTION);
      const annualTax = taxableAmount * NPS_TAX_CONSTANTS.TAX_RATE;
      const monthlyTax = Math.round(annualTax / 12);

      return {
        grossAmount: monthlyBenefit,
        taxAmount: monthlyTax,
        netAmount: monthlyBenefit - monthlyTax
      };
    }

    /**
     * ì—°ë ¹ë³„ ê°œì¸ì—°ê¸ˆ ì„¸ìœ¨ ì¡°íšŒ
     * @param {number} age - ìˆ˜ë ¹ ì‹œ ì—°ë ¹
     * @returns {number} ì„¸ìœ¨
     */
    function getPrivatePensionTaxRate(age) {
      if (age >= 80) return PRIVATE_PENSION_TAX_RATES.OVER_80;
      if (age >= 70) return PRIVATE_PENSION_TAX_RATES.UNDER_80;
      return PRIVATE_PENSION_TAX_RATES.UNDER_70;
    }

    /**
     * ê°œì¸ì—°ê¸ˆ ì„¸ê¸ˆ ê³„ì‚°
     * @param {number} monthlyBenefit - ì›” ìˆ˜ë ¹ì•¡
     * @param {number} age - ìˆ˜ë ¹ ì‹œ ì—°ë ¹ (ê¸°ë³¸ê°’: 60)
     * @returns {{grossAmount: number, taxAmount: number, netAmount: number, taxRate: number}}
     */
    function calculatePrivatePensionTax(monthlyBenefit, age = 60) {
      if (!monthlyBenefit || monthlyBenefit <= 0) {
        return { grossAmount: 0, taxAmount: 0, netAmount: 0, taxRate: 0 };
      }

      const taxRate = getPrivatePensionTaxRate(age);
      const taxAmount = Math.round(monthlyBenefit * taxRate);

      return {
        grossAmount: monthlyBenefit,
        taxAmount,
        netAmount: monthlyBenefit - taxAmount,
        taxRate
      };
    }

    // ============================================================
    // @TEST:DATA-001 | SPEC: SPEC-DATA-001/spec.md
    // í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì •ì˜ (RED Phase)
    // ============================================================

    /**
     * DATA-001 í…ŒìŠ¤íŠ¸ ìŠ¤ìœ„íŠ¸
     * ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ runTests() ì‹¤í–‰
     */
    async function runTests() {
      console.log('=== @TEST:DATA-001 í…ŒìŠ¤íŠ¸ ì‹œì‘ ===');
      let passed = 0;
      let failed = 0;

      const tests = [
        // TC-DATA-001-01: í•¨ìˆ˜ ì¡´ì¬ ì—¬ë¶€
        {
          name: 'loadData í•¨ìˆ˜ ì¡´ì¬',
          test: () => typeof loadData === 'function'
        },
        {
          name: 'validateData í•¨ìˆ˜ ì¡´ì¬',
          test: () => typeof validateData === 'function'
        },
        {
          name: 'getData í•¨ìˆ˜ ì¡´ì¬',
          test: () => typeof getData === 'function'
        },

        // TC-DATA-001-02: ë°ì´í„° êµ¬ì¡° ê²€ì¦
        {
          name: 'APP_DATAê°€ nullì´ ì•„ë‹˜',
          test: () => APP_DATA !== null
        },
        {
          name: 'nps.a_valueê°€ ìˆ«ì',
          test: () => typeof APP_DATA?.nps?.a_value === 'number'
        },
        {
          name: 'nps.a_valueê°€ ì–‘ìˆ˜',
          test: () => APP_DATA?.nps?.a_value > 0
        },
        {
          name: 'nps.replacement_rateê°€ 0~1 ì‚¬ì´',
          test: () => {
            const rate = APP_DATA?.nps?.replacement_rate;
            return rate >= 0 && rate <= 1;
          }
        },
        {
          name: 'market.sp500_10yr_avgê°€ ìˆ«ì',
          test: () => typeof APP_DATA?.market?.sp500_10yr_avg === 'number'
        },
        {
          name: 'wage_curve.30sê°€ ìˆ«ì',
          test: () => typeof APP_DATA?.wage_curve?.['30s'] === 'number'
        },
        {
          name: 'updated_atì´ ë¬¸ìì—´',
          test: () => typeof APP_DATA?.updated_at === 'string'
        },

        // TC-DATA-001-03: getData í•¨ìˆ˜ í…ŒìŠ¤íŠ¸
        {
          name: 'getData("nps.a_value") ë™ì‘',
          test: () => getData('nps.a_value') === APP_DATA?.nps?.a_value
        },
        {
          name: 'getData ì˜ëª»ëœ ê²½ë¡œëŠ” undefined',
          test: () => getData('invalid.path') === undefined
        },

        // ============================================================
        // @TEST:CALC-001 | SPEC: SPEC-CALC-001/spec.md (30ì„¸ ê¸°ì¤€ ìˆ˜ì •)
        // ============================================================
        {
          name: 'calculateWageCurve í•¨ìˆ˜ ì¡´ì¬',
          test: () => typeof calculateWageCurve === 'function'
        },
        {
          name: 'getWageGrowthRate í•¨ìˆ˜ ì¡´ì¬',
          test: () => typeof getWageGrowthRate === 'function'
        },
        {
          name: '35ì„¸ 5000ë§Œì› â†’ 31ê°œ ê²°ê³¼ (30ì„¸~60ì„¸)',
          test: () => calculateWageCurve(35, 50000000).length === 29
        },
        {
          name: '35ì„¸ ì…ë ¥ â†’ ì²« ê²°ê³¼ëŠ” 30ì„¸',
          test: () => {
            const result = calculateWageCurve(35, 50000000);
            return result[0]?.age === 30;
          }
        },
        {
          name: '25ì„¸ ì…ë ¥ â†’ 25ì„¸ë¶€í„° ê³„ì‚° (30ì„¸ ë¯¸ë§Œ)',
          test: () => {
            const result = calculateWageCurve(25, 30000000);
            return result[0]?.age === 25 && result.length === 36; // 25-60ì„¸ = 36ë…„
          }
        },
        {
          name: '30ì„¸ ìƒìŠ¹ë¥  5% ì ìš©',
          test: () => {
            const result = calculateWageCurve(30, 50000000);
            return result[1]?.income === Math.round(50000000 * 1.05);
          }
        },
        {
          name: 'ì˜ëª»ëœ ë‚˜ì´(15ì„¸) â†’ ë¹ˆ ë°°ì—´',
          test: () => calculateWageCurve(15, 50000000).length === 0
        },
        {
          name: 'ì˜ëª»ëœ ì†Œë“(ìŒìˆ˜) â†’ ë¹ˆ ë°°ì—´',
          test: () => calculateWageCurve(30, -1000).length === 0
        },
        {
          name: '59ì„¸ â†’ 31ê°œ ê²°ê³¼ (30ì„¸~60ì„¸)',
          test: () => calculateWageCurve(59, 50000000).length === 29
        },

        // ============================================================
        // @TEST:CALC-002 | SPEC: SPEC-CALC-002/spec.md
        // ============================================================
        {
          name: 'calculateNPS í•¨ìˆ˜ ì¡´ì¬',
          test: () => typeof calculateNPS === 'function'
        },
        {
          name: 'getStandardMonthlyIncome í•¨ìˆ˜ ì¡´ì¬',
          test: () => typeof getStandardMonthlyIncome === 'function'
        },
        {
          name: 'ë¹ˆ ë°°ì—´ â†’ monthlyBenefit 0',
          test: () => calculateNPS([]).monthlyBenefit === 0
        },
        {
          name: 'ê·¼ë¡œì ì—°ê¸ˆ ê³„ì‚° ê²°ê³¼ ì–‘ìˆ˜',
          test: () => {
            const incomes = calculateWageCurve(30, 50000000);
            const result = calculateNPS(incomes, 'laborer');
            return result.monthlyBenefit > 0;
          }
        },
        {
          name: 'ê·¼ë¡œì: selfContribution === employerContribution',
          test: () => {
            const incomes = calculateWageCurve(30, 50000000);
            const result = calculateNPS(incomes, 'laborer');
            return result.selfContribution === result.employerContribution;
          }
        },
        {
          name: 'ì‚¬ì—…ì: employerContribution === 0',
          test: () => {
            const incomes = calculateWageCurve(30, 50000000);
            const result = calculateNPS(incomes, 'business');
            return result.employerContribution === 0;
          }
        },
        {
          name: 'ê¸°ì¤€ì†Œë“ì›”ì•¡ ìƒí•œ ì ìš© (590ë§Œì›)',
          test: () => {
            const result = getStandardMonthlyIncome(100000000); // ì—° 1ì–µ
            return result === 5900000;
          }
        },
        {
          name: 'ê¸°ì¤€ì†Œë“ì›”ì•¡ í•˜í•œ ì ìš© (37ë§Œì›)',
          test: () => {
            const result = getStandardMonthlyIncome(1000000); // ì—° 100ë§Œì›
            return result === 370000;
          }
        },

        // ============================================================
        // @TEST:CALC-003 | SPEC: SPEC-CALC-003/spec.md
        // ============================================================
        {
          name: 'calculatePrivatePension í•¨ìˆ˜ ì¡´ì¬',
          test: () => typeof calculatePrivatePension === 'function'
        },
        {
          name: 'PRIVATE_PENSION_PRODUCTS ìƒìˆ˜ ì¡´ì¬ (3ê°œ ìƒí’ˆ)',
          test: () => Array.isArray(PRIVATE_PENSION_PRODUCTS) && PRIVATE_PENSION_PRODUCTS.length === 3
        },
        {
          name: 'ë¹ˆ ë°°ì—´ â†’ 3ê°œ ìƒí’ˆ ê²°ê³¼ (ëª¨ë‘ 0)',
          test: () => {
            const results = calculatePrivatePension([]);
            return results.length === 3 && results.every(r => r.monthlyBenefit === 0);
          }
        },
        {
          name: 'ì „ì²´ ìƒí’ˆ ê³„ì‚° â†’ 3ê°œ ê²°ê³¼',
          test: () => {
            const incomes = calculateWageCurve(30, 50000000);
            const results = calculatePrivatePension(incomes);
            return results.length === 3;
          }
        },
        {
          name: 'S&P500 > TDF > ì˜ˆê¸ˆí˜• ìˆœì„œ (ìˆ˜ìµë¥ )',
          test: () => {
            const incomes = calculateWageCurve(30, 50000000);
            const results = calculatePrivatePension(incomes);
            const sp500 = results.find(r => r.productId === 'sp500');
            const tdf = results.find(r => r.productId === 'tdf2050');
            const savings = results.find(r => r.productId === 'savings');
            return sp500.totalBalance > tdf.totalBalance && tdf.totalBalance > savings.totalBalance;
          }
        },
        {
          name: 'ë‹¨ì¼ ìƒí’ˆ ì§€ì • â†’ 1ê°œ ê²°ê³¼',
          test: () => {
            const incomes = calculateWageCurve(30, 50000000);
            const results = calculatePrivatePension(incomes, PRIVATE_PENSION_PRODUCTS[0]);
            return results.length === 1 && results[0].productId === 'sp500';
          }
        },
        {
          name: 'totalBalance > totalContribution (ë³µë¦¬ íš¨ê³¼)',
          test: () => {
            const incomes = calculateWageCurve(30, 50000000);
            const results = calculatePrivatePension(incomes);
            return results.every(r => r.totalBalance > r.totalContribution);
          }
        },

        // ============================================================
        // @TEST:TAX-001 | SPEC: SPEC-TAX-001/spec.md
        // ============================================================
        {
          name: 'calculateNPSTax í•¨ìˆ˜ ì¡´ì¬',
          test: () => typeof calculateNPSTax === 'function'
        },
        {
          name: 'calculatePrivatePensionTax í•¨ìˆ˜ ì¡´ì¬',
          test: () => typeof calculatePrivatePensionTax === 'function'
        },
        {
          name: 'êµ­ë¯¼ì—°ê¸ˆ 0ì› â†’ ì„¸ê¸ˆ 0',
          test: () => calculateNPSTax(0).taxAmount === 0
        },
        {
          name: 'êµ­ë¯¼ì—°ê¸ˆ ì›” 20ë§Œì› (ì—° 240ë§Œì›) â†’ ë¹„ê³¼ì„¸',
          test: () => calculateNPSTax(200000).taxAmount === 0
        },
        {
          name: 'êµ­ë¯¼ì—°ê¸ˆ ì›” 100ë§Œì› â†’ ì„¸ê¸ˆ ë°œìƒ',
          test: () => {
            const result = calculateNPSTax(1000000);
            // ì—° 1200ë§Œì› - 350ë§Œì› = 850ë§Œì› Ã— 5% = 42.5ë§Œì›/ë…„ â‰ˆ 35,417ì›/ì›”
            return result.taxAmount > 0 && result.netAmount < result.grossAmount;
          }
        },
        {
          name: 'êµ­ë¯¼ì—°ê¸ˆ ì„¸í›„ = ì„¸ì „ - ì„¸ê¸ˆ',
          test: () => {
            const result = calculateNPSTax(1000000);
            return result.netAmount === result.grossAmount - result.taxAmount;
          }
        },
        {
          name: 'ê°œì¸ì—°ê¸ˆ 0ì› â†’ ì„¸ê¸ˆ 0',
          test: () => calculatePrivatePensionTax(0).taxAmount === 0
        },
        {
          name: 'ê°œì¸ì—°ê¸ˆ 60ì„¸ â†’ 5.5% ì„¸ìœ¨',
          test: () => calculatePrivatePensionTax(1000000, 60).taxRate === 0.055
        },
        {
          name: 'ê°œì¸ì—°ê¸ˆ 75ì„¸ â†’ 4.4% ì„¸ìœ¨',
          test: () => calculatePrivatePensionTax(1000000, 75).taxRate === 0.044
        },
        {
          name: 'ê°œì¸ì—°ê¸ˆ 85ì„¸ â†’ 3.3% ì„¸ìœ¨',
          test: () => calculatePrivatePensionTax(1000000, 85).taxRate === 0.033
        },
        {
          name: 'ê°œì¸ì—°ê¸ˆ ì›” 100ë§Œì›, 60ì„¸ â†’ ì„¸ê¸ˆ 55,000ì›',
          test: () => calculatePrivatePensionTax(1000000, 60).taxAmount === 55000
        },

        // ============================================================
        // @TEST:UI-001 | SPEC: SPEC-UI-001/spec.md
        // ============================================================
        {
          name: 'getFormData í•¨ìˆ˜ ì¡´ì¬',
          test: () => typeof getFormData === 'function'
        },
        {
          name: 'validateFormData í•¨ìˆ˜ ì¡´ì¬',
          test: () => typeof validateFormData === 'function'
        },
        {
          name: 'executeCalculation í•¨ìˆ˜ ì¡´ì¬',
          test: () => typeof executeCalculation === 'function'
        },
        {
          name: 'toggleJobType í•¨ìˆ˜ ì¡´ì¬',
          test: () => typeof toggleJobType === 'function'
        },
        {
          name: 'ìœ íš¨í•œ ë°ì´í„° ê²€ì¦ í†µê³¼',
          test: () => {
            const result = validateFormData({ currentAge: 30, currentIncome: 50000000 });
            return result.isValid === true && result.errors.length === 0;
          }
        },
        {
          name: 'ì˜ëª»ëœ ë‚˜ì´ ê²€ì¦ ì‹¤íŒ¨',
          test: () => {
            const result = validateFormData({ currentAge: 15, currentIncome: 50000000 });
            return result.isValid === false && result.errors.length > 0;
          }
        },
        {
          name: 'ì˜ëª»ëœ ì†Œë“ ê²€ì¦ ì‹¤íŒ¨',
          test: () => {
            const result = validateFormData({ currentAge: 30, currentIncome: -1000 });
            return result.isValid === false && result.errors.length > 0;
          }
        },

        // ============================================================
        // @TEST:UI-002 | SPEC: SPEC-UI-002/spec.md
        // ============================================================
        {
          name: 'formatCurrency í•¨ìˆ˜ ì¡´ì¬',
          test: () => typeof formatCurrency === 'function'
        },
        {
          name: 'renderResultTable í•¨ìˆ˜ ì¡´ì¬',
          test: () => typeof renderResultTable === 'function'
        },
        {
          name: 'renderSummaryCards í•¨ìˆ˜ ì¡´ì¬',
          test: () => typeof renderSummaryCards === 'function'
        },
        {
          name: 'formatCurrency 0ì› â†’ "-"',
          test: () => formatCurrency(0) === '-'
        },
        {
          name: 'formatCurrency 5000ë§Œì› í¬ë§·',
          test: () => formatCurrency(50000000) === '5,000ë§Œì›'
        },
        {
          name: 'formatCurrency ì› ë‹¨ìœ„ í¬ë§·',
          test: () => formatCurrency(1234567, 'ì›') === '1,234,567ì›'
        },
        {
          name: 'formatCurrency null â†’ "-"',
          test: () => formatCurrency(null) === '-'
        },

        // ============================================================
        // @TEST:CSV-001 | CSV ë¡œë”© ë° íŒŒì‹± í…ŒìŠ¤íŠ¸
        // ============================================================
        {
          name: 'parseCSV í•¨ìˆ˜ ì¡´ì¬',
          test: () => typeof parseCSV === 'function'
        },
        {
          name: 'calculateAverageInflation í•¨ìˆ˜ ì¡´ì¬',
          test: () => typeof calculateAverageInflation === 'function'
        },
        {
          name: 'BANK_PENSION_PRODUCTS ë°°ì—´ ì¡´ì¬',
          test: () => Array.isArray(BANK_PENSION_PRODUCTS)
        },
        {
          name: 'ALL_PENSION_PRODUCTS ë°°ì—´ ì¡´ì¬',
          test: () => Array.isArray(ALL_PENSION_PRODUCTS)
        },
        {
          name: 'INFLATION_RATEê°€ ìˆ«ì',
          test: () => typeof INFLATION_RATE === 'number'
        },
        {
          name: 'INFLATION_RATEê°€ 0~0.1 ë²”ìœ„',
          test: () => INFLATION_RATE >= 0 && INFLATION_RATE <= 0.1
        },

        // ============================================================
        // @TEST:CALC-004 | 60-80ì„¸ ìˆ˜ë ¹ì•¡ ê³„ì‚° í…ŒìŠ¤íŠ¸
        // ============================================================
        {
          name: 'calculateNPSWithInflation í•¨ìˆ˜ ì¡´ì¬',
          test: () => typeof calculateNPSWithInflation === 'function'
        },
        {
          name: 'calculatePrivatePensionReceiving í•¨ìˆ˜ ì¡´ì¬',
          test: () => typeof calculatePrivatePensionReceiving === 'function'
        },
        {
          name: 'êµ­ë¯¼ì—°ê¸ˆ ë¬¼ê°€ì—°ë™ 21ê°œ ê²°ê³¼ (65~85ì„¸)',
          test: () => calculateNPSWithInflation(1000000).length === 21
        },
        {
          name: 'êµ­ë¯¼ì—°ê¸ˆ 85ì„¸ ìˆ˜ë ¹ì•¡ > 65ì„¸ ìˆ˜ë ¹ì•¡ (ë¬¼ê°€ì—°ë™)',
          test: () => {
            const results = calculateNPSWithInflation(1000000);
            return results[20].monthlyBenefit > results[0].monthlyBenefit;
          }
        },
        {
          name: 'ê°œì¸ì—°ê¸ˆ 21ê°œ ê²°ê³¼ (65~85ì„¸)',
          test: () => calculatePrivatePensionReceiving(100000000).length === 21
        },
        {
          name: 'ê°œì¸ì—°ê¸ˆ ê³ ì • ìˆ˜ë ¹ì•¡ (ëª…ëª©)',
          test: () => {
            const results = calculatePrivatePensionReceiving(100000000);
            return results[0].monthlyBenefit === results[20].monthlyBenefit;
          }
        },
        {
          name: 'ê°œì¸ì—°ê¸ˆ ì‹¤ì§ˆê°€ì¹˜ í•˜ë½',
          test: () => {
            const results = calculatePrivatePensionReceiving(100000000);
            return results[20].realValue < results[0].realValue;
          }
        },
        {
          name: 'renderReceivingTable í•¨ìˆ˜ ì¡´ì¬',
          test: () => typeof renderReceivingTable === 'function'
        }
      ];

      for (const t of tests) {
        try {
          const result = t.test();
          if (result) {
            console.log('%câœ… ' + t.name, 'color: green');
            passed++;
          } else {
            console.log('%câŒ ' + t.name, 'color: red');
            failed++;
          }
        } catch (e) {
          console.log('%câŒ ' + t.name + ' - Error: ' + e.message, 'color: red');
          failed++;
        }
      }

      console.log(`=== ê²°ê³¼: ${passed}/${passed + failed} í†µê³¼ ===`);
      return { passed, failed };
    }

    // í…ŒìŠ¤íŠ¸ë¥¼ ì „ì—­ì—ì„œ ì‹¤í–‰ ê°€ëŠ¥í•˜ë„ë¡ ë…¸ì¶œ
    window.runTests = runTests;
  </script>
</body>
</html>
